"use strict";(self["webpackChunkhousehold_services"]=self["webpackChunkhousehold_services"]||[]).push([[424],{424:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"professional-dashboard"},[t("div",{staticClass:"container py-4"},[t("div",{staticClass:"row mb-4"},[t("div",{staticClass:"col-lg-8"},[t("h2",[e._v("Welcome, "+e._s(e.professionalName)+"!")]),t("p",{staticClass:"text-muted"},[e._v("Manage your service assignments and view customer requests")]),t("div",{staticClass:"stats-cards row g-3 mt-3"},[t("div",{staticClass:"col-md-4"},[t("div",{staticClass:"card bg-primary text-white"},[t("div",{staticClass:"card-body"},[t("h6",{staticClass:"card-title"},[e._v("Pending Requests")]),t("h3",{staticClass:"mb-0"},[e._v(e._s(e.pendingRequests.length))])])])]),t("div",{staticClass:"col-md-4"},[t("div",{staticClass:"card bg-success text-white"},[t("div",{staticClass:"card-body"},[t("h6",{staticClass:"card-title"},[e._v("In Progress")]),t("h3",{staticClass:"mb-0"},[e._v(e._s(e.inProgressRequests.length))])])])]),t("div",{staticClass:"col-md-4"},[t("div",{staticClass:"card bg-info text-white"},[t("div",{staticClass:"card-body"},[t("h6",{staticClass:"card-title"},[e._v("Completed")]),t("h3",{staticClass:"mb-0"},[e._v(e._s(e.completedRequests.length))])])])])])]),t("div",{staticClass:"col-lg-4 mt-4 mt-lg-0"},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-body"},[t("h5",{staticClass:"card-title"},[e._v("Your Service Profile")]),t("div",{staticClass:"d-flex align-items-center mb-3"},[t("div",{staticClass:"rating me-2"},e._l(5,(function(s){return t("i",{key:s,staticClass:"fas fa-star",class:s<=Math.round(e.profile.average_rating)?"text-warning":"text-muted"})})),0),t("span",[e._v(e._s(e.profile.average_rating.toFixed(1))+" / 5 ("+e._s(e.profile.total_reviews)+" reviews)")])]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Service:")]),e._v(" "+e._s(e.profile.service_type))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Experience:")]),e._v(" "+e._s(e.profile.experience)+" years")]),t("p",{staticClass:"mb-0"},[t("strong",[e._v("Status:")]),t("span",{staticClass:"badge",class:e.profile.is_approved?"bg-success":"bg-warning"},[e._v(" "+e._s(e.profile.is_approved?"Approved":"Pending Approval")+" ")])]),t("div",{staticClass:"mt-3"},[t("button",{staticClass:"btn btn-outline-primary btn-sm",on:{click:function(t){e.showProfileModal=!0}}},[t("i",{staticClass:"fas fa-user-edit me-1"}),e._v(" View Full Profile ")])])])])])]),t("div",{staticClass:"card mb-4"},[t("div",{staticClass:"card-body d-flex justify-content-between align-items-center"},[e._m(0),t("div",{staticClass:"form-check form-switch"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.isAvailable,expression:"isAvailable"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"availabilitySwitch"},domProps:{checked:Array.isArray(e.isAvailable)?e._i(e.isAvailable,null)>-1:e.isAvailable},on:{change:[function(t){var s=e.isAvailable,a=t.target,i=!!a.checked;if(Array.isArray(s)){var r=null,l=e._i(s,r);a.checked?l<0&&(e.isAvailable=s.concat([r])):l>-1&&(e.isAvailable=s.slice(0,l).concat(s.slice(l+1)))}else e.isAvailable=i},e.updateAvailability]}}),t("label",{staticClass:"form-check-label",attrs:{for:"availabilitySwitch"}},[t("span",{staticClass:"badge",class:e.isAvailable?"bg-success":"bg-secondary"},[e._v(" "+e._s(e.isAvailable?"Available":"Unavailable")+" ")])])])])]),t("ul",{staticClass:"nav nav-tabs mb-4"},[t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"pending"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="pending"}}},[t("i",{staticClass:"fas fa-clock me-1"}),e._v(" New Requests "),e.pendingRequests.length?t("span",{staticClass:"badge bg-danger ms-1"},[e._v(e._s(e.pendingRequests.length))]):e._e()])]),t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"assigned"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="assigned"}}},[t("i",{staticClass:"fas fa-tools me-1"}),e._v(" In Progress ")])]),t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"completed"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="completed"}}},[t("i",{staticClass:"fas fa-check-circle me-1"}),e._v(" Completed ")])]),t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"reviews"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="reviews"}}},[t("i",{staticClass:"fas fa-star me-1"}),e._v(" My Reviews ")])])]),e.loading?t("div",{staticClass:"text-center my-5"},[e._m(1),t("p",{staticClass:"mt-2"},[e._v("Loading service requests...")])]):0===e.filteredRequests.length&&"reviews"!==e.activeTab?t("div",{staticClass:"text-center py-5"},[t("i",{staticClass:"fas fa-inbox fa-3x text-muted mb-3"}),t("h5",[e._v("No service requests found")]),t("p",{staticClass:"text-muted"},[e._v(e._s(e.getEmptyStateMessage()))])]):"reviews"!==e.activeTab?t("div",{staticClass:"row g-4"},e._l(e.filteredRequests,(function(s){return t("div",{key:s.id,staticClass:"col-md-6"},[t("div",{staticClass:"card h-100"},[t("div",{staticClass:"card-header d-flex justify-content-between align-items-center"},[t("span",{class:e.getStatusBadgeClass(s.status)},[e._v(" "+e._s(s.status)+" ")]),t("span",{staticClass:"text-muted small"},[t("i",{staticClass:"fas fa-calendar me-1"}),e._v(" "+e._s(e.formatDate(s.created_at))+" ")])]),t("div",{staticClass:"card-body"},[t("h5",{staticClass:"card-title"},[e._v(e._s(s.service.name))]),t("p",{staticClass:"card-text"},[t("strong",[e._v("Customer:")]),e._v(" "+e._s(s.customer.customer_name)+" ")]),t("p",{staticClass:"card-text"},[t("strong",[e._v("Location:")]),e._v(" PIN Code "+e._s(s.pin_code)+" ")]),e._v(" to it "),t("div",{staticClass:"mb-3"},[e.isNewCustomerRequest(s)?t("span",{staticClass:"badge bg-info mb-2"},[e._v("New Customer Request")]):e._e()]),t("div",{staticClass:"mb-3"},[t("strong",[e._v("Instructions:")]),t("p",{staticClass:"small text-muted"},[e._v(e._s(s.special_instructions||"No special instructions provided."))])]),t("div",{staticClass:"mb-3"},["pending"===s.status?[t("button",{staticClass:"btn btn-success btn-sm me-2",on:{click:function(t){return e.acceptRequest(s.id)}}},[t("i",{staticClass:"fas fa-check me-1"}),e._v(" Accept ")]),t("button",{staticClass:"btn btn-danger btn-sm me-2",on:{click:function(t){return e.rejectRequest(s.id)}}},[t("i",{staticClass:"fas fa-times me-1"}),e._v(" Reject ")])]:e._e(),"in_progress"===s.status?t("button",{staticClass:"btn btn-primary btn-sm me-2",on:{click:function(t){return e.completeRequest(s.id)}}},[t("i",{staticClass:"fas fa-check-circle me-1"}),e._v(" Mark as Completed ")]):e._e(),t("button",{staticClass:"btn btn-outline-secondary btn-sm",on:{click:function(t){return e.viewRequestDetails(s)}}},[t("i",{staticClass:"fas fa-eye me-1"}),e._v(" Details ")])],2)]),"completed"===s.status?t("div",{staticClass:"card-footer text-muted"},[s.review?t("div",{staticClass:"mt-2"},[t("strong",[e._v("Customer Review:")]),t("div",{staticClass:"d-flex align-items-center"},[t("div",{staticClass:"rating me-2"},e._l(5,(function(e){return t("i",{key:e,staticClass:"fas fa-star",class:e<=s.review.rating?"text-warning":"text-muted"})})),0),t("span",[e._v(e._s(s.review.remarks))])])]):t("div",[t("i",{staticClass:"fas fa-star-half-alt me-1"}),e._v(" Awaiting customer review ")])]):e._e()])])})),0):e._e(),"reviews"===e.activeTab?t("div",{staticClass:"reviews-tab"},[0===e.reviews.length?t("div",{staticClass:"text-center py-5"},[t("i",{staticClass:"fas fa-star fa-3x text-muted mb-3"}),t("h5",[e._v("No Reviews Yet")]),t("p",{staticClass:"text-muted"},[e._v("Complete service requests to receive customer reviews")])]):t("div",{staticClass:"card"},[t("div",{staticClass:"card-header bg-white"},[t("div",{staticClass:"d-flex justify-content-between align-items-center"},[t("h5",{staticClass:"mb-0"},[e._v("Customer Reviews")]),t("div",{staticClass:"rating-summary"},[t("span",{staticClass:"badge bg-primary rounded-pill"},[t("i",{staticClass:"fas fa-star me-1"}),e._v(" "+e._s(e.profile.average_rating.toFixed(1))+"/5 ")])])])]),t("div",{staticClass:"card-body p-0"},[t("div",{staticClass:"list-group list-group-flush"},e._l(e.reviews,(function(s){return t("div",{key:s.id,staticClass:"list-group-item"},[t("div",{staticClass:"d-flex justify-content-between align-items-start mb-2"},[t("div",[t("h6",{staticClass:"mb-0"},[e._v(e._s(s.customer_name))]),t("small",{staticClass:"text-muted"},[e._v(e._s(e.formatDate(s.date_created)))])]),t("div",{staticClass:"rating"},e._l(5,(function(e){return t("i",{key:e,staticClass:"fas fa-star",class:e<=s.rating?"text-warning":"text-muted"})})),0)]),t("p",{staticClass:"mb-0"},[e._v(e._s(s.remarks))]),t("small",{staticClass:"text-muted"},[e._v("Service: "+e._s(s.service_name))])])})),0)])])]):e._e()]),e.showDetailsModal?t("div",{staticClass:"modal fade",class:{show:e.showDetailsModal}},[t("div",{staticClass:"modal-dialog"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("Request Details")]),t("button",{staticClass:"btn-close",attrs:{type:"button"},on:{click:function(t){e.showDetailsModal=!1}}})]),e.selectedRequest?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"mb-3"},[t("h6",[e._v("Service Information")]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Service:")]),e._v(" "+e._s(e.selectedRequest.service.name))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Price:")]),e._v(" â‚¹"+e._s(e.selectedRequest.service.base_price))]),t("p",[t("strong",[e._v("Status:")]),t("span",{class:e.getStatusBadgeClass(e.selectedRequest.status)},[e._v(" "+e._s(e.selectedRequest.status)+" ")])])]),t("div",{staticClass:"mb-3"},[t("h6",[e._v("Customer Information")]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Name:")]),e._v(" "+e._s(e.selectedRequest.customer.customer_name))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Phone:")]),e._v(" "+e._s(e.selectedRequest.customer.phone))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("PIN Code:")]),e._v(" "+e._s(e.selectedRequest.pin_code))]),t("p",{staticClass:"mb-0"},[t("strong",[e._v("Address:")]),e._v(" "+e._s(e.selectedRequest.customer.address)+" ")])]),t("div",{staticClass:"mb-3"},[t("h6",[e._v("Timeline")]),t("ul",{staticClass:"timeline"},[t("li",{staticClass:"mb-2"},[t("strong",[e._v("Created:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.created_at)))]),e.selectedRequest.accepted_at?t("li",{staticClass:"mb-2"},[t("strong",[e._v("Accepted:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.accepted_at))+" ")]):e._e(),e.selectedRequest.completed_at?t("li",{staticClass:"mb-2"},[t("strong",[e._v("Completed:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.completed_at))+" ")]):e._e(),e.selectedRequest.closed_at?t("li",[t("strong",[e._v("Closed:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.closed_at))+" ")]):e._e()])]),t("div",{staticClass:"mb-0"},[t("h6",[e._v("Special Instructions")]),t("p",{staticClass:"mb-0"},[e._v(e._s(e.selectedRequest.special_instructions||"No special instructions provided."))])]),"in_progress"===e.selectedRequest.status?t("div",{staticClass:"mt-3"},[e._m(2),t("div",{staticClass:"form-check"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedRequest.exited_location,expression:"selectedRequest.exited_location"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"exitedLocation"},domProps:{checked:Array.isArray(e.selectedRequest.exited_location)?e._i(e.selectedRequest.exited_location,null)>-1:e.selectedRequest.exited_location},on:{change:function(t){var s=e.selectedRequest.exited_location,a=t.target,i=!!a.checked;if(Array.isArray(s)){var r=null,l=e._i(s,r);a.checked?l<0&&e.$set(e.selectedRequest,"exited_location",s.concat([r])):l>-1&&e.$set(e.selectedRequest,"exited_location",s.slice(0,l).concat(s.slice(l+1)))}else e.$set(e.selectedRequest,"exited_location",i)}}}),e._m(3)])]):e._e(),"completed"===e.selectedRequest.status?t("div",{staticClass:"mt-3"},[e._m(4)]):e._e()]):e._e(),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(t){e.showDetailsModal=!1}}},[e._v("Close")]),e.selectedRequest&&"pending"===e.selectedRequest.status?[t("button",{staticClass:"btn btn-success",on:{click:function(t){return e.acceptRequest(e.selectedRequest.id,!0)}}},[t("i",{staticClass:"fas fa-check me-1"}),e._v(" Accept ")]),t("button",{staticClass:"btn btn-danger",on:{click:function(t){return e.rejectRequest(e.selectedRequest.id,!0)}}},[t("i",{staticClass:"fas fa-times me-1"}),e._v(" Reject ")])]:e._e(),e.selectedRequest&&"in_progress"===e.selectedRequest.status?t("button",{staticClass:"btn btn-primary",attrs:{disabled:!e.selectedRequest.exited_location},on:{click:function(t){return e.completeRequest(e.selectedRequest.id,!0)}}},[t("i",{staticClass:"fas fa-check-circle me-1"}),e._v(" Mark as Completed ")]):e._e()],2)])])]):e._e(),e.showProfileModal?t("div",{staticClass:"modal fade",class:{show:e.showProfileModal}},[t("div",{staticClass:"modal-dialog modal-lg"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("Professional Profile")]),t("button",{staticClass:"btn-close",attrs:{type:"button"},on:{click:function(t){e.showProfileModal=!1}}})]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-4 text-center mb-4 mb-md-0"},[e._m(5),t("h4",[e._v(e._s(e.professionalName))]),t("div",{staticClass:"rating mb-2"},[e._l(5,(function(s){return t("i",{key:s,staticClass:"fas fa-star",class:s<=Math.round(e.profile.average_rating)?"text-warning":"text-muted"})})),t("span",{staticClass:"ms-1"},[e._v(e._s(e.profile.average_rating.toFixed(1))+"/5")])],2),t("p",{staticClass:"badge bg-primary"},[e._v(e._s(e.profile.service_type))])]),t("div",{staticClass:"col-md-8"},[t("div",{staticClass:"mb-3"},[t("h6",[e._v("About Me")]),t("p",[e._v(e._s(e.profile.description||"No description provided."))])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-6 mb-3"},[t("h6",[e._v("Experience")]),t("p",[e._v(e._s(e.profile.experience)+" years")])]),t("div",{staticClass:"col-md-6 mb-3"},[t("h6",[e._v("Joined")]),t("p",[e._v(e._s(e.formatDate(e.profile.date_created)))])])]),t("div",{staticClass:"mb-3"},[t("h6",[e._v("Specialization")]),t("p",[e._v(e._s(e.profile.service_type))])]),t("div",{staticClass:"mb-3"},[t("h6",[e._v("Contact Information")]),t("p",{staticClass:"mb-1"},[t("i",{staticClass:"fas fa-envelope me-2"}),e._v(" "+e._s(e.profile.email))]),t("p",{staticClass:"mb-0"},[t("i",{staticClass:"fas fa-phone me-2"}),e._v(" "+e._s(e.profile.phone||"Not provided"))])])])]),t("hr"),t("div",{staticClass:"profile-edit-section"},[t("h5",{staticClass:"mb-3"},[e._v("Edit Profile")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.updateProfile.apply(null,arguments)}}},[t("div",{staticClass:"mb-3"},[t("label",{staticClass:"form-label"},[e._v("Description")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.profileForm.description,expression:"profileForm.description"}],staticClass:"form-control",attrs:{rows:"3"},domProps:{value:e.profileForm.description},on:{input:function(t){t.target.composing||e.$set(e.profileForm,"description",t.target.value)}}})]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-md-6 mb-3"},[t("label",{staticClass:"form-label"},[e._v("Phone")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.profileForm.phone,expression:"profileForm.phone"}],staticClass:"form-control",attrs:{type:"tel"},domProps:{value:e.profileForm.phone},on:{input:function(t){t.target.composing||e.$set(e.profileForm,"phone",t.target.value)}}})]),t("div",{staticClass:"col-md-6 mb-3"},[t("label",{staticClass:"form-label"},[e._v("Experience (years)")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.profileForm.experience,expression:"profileForm.experience"}],staticClass:"form-control",attrs:{type:"number",min:"0"},domProps:{value:e.profileForm.experience},on:{input:function(t){t.target.composing||e.$set(e.profileForm,"experience",t.target.value)}}})])]),t("div",{staticClass:"text-end"},[t("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:e.updatingProfile}},[e.updatingProfile?t("span",{staticClass:"spinner-border spinner-border-sm me-1"}):e._e(),e._v(" Save Changes ")])])])])])])])]):e._e(),e.error?t("div",{staticClass:"alert alert-danger mt-4"},[e._m(6),t("p",[e._v(e._s(e.error))]),t("div",{staticClass:"mt-2"},[t("button",{staticClass:"btn btn-primary btn-sm me-2",on:{click:e.resetError}},[t("i",{staticClass:"fas fa-sync me-1"}),e._v(" Retry ")])])]):e._e(),e.isDevelopment?t("div",{staticClass:"mt-4 p-3 bg-light rounded"},[t("div",{staticClass:"d-flex justify-content-between align-items-center"},[t("h5",{staticClass:"mb-0"},[e._v("Developer Tools")]),t("div",[t("button",{staticClass:"btn btn-primary btn-sm me-2",on:{click:e.refreshRequests}},[t("i",{staticClass:"fas fa-sync me-1"}),e._v(" Refresh Requests ")]),t("button",{staticClass:"btn btn-warning btn-sm",on:{click:e.refreshAllPendingRequests}},[t("i",{staticClass:"fas fa-search me-1"}),e._v(" Show All Pending Requests ")])])]),t("div",{staticClass:"mt-3"},[t("h6",[e._v("Debug Information:")]),t("div",{staticClass:"small"},[t("p",{staticClass:"mb-1"},[t("strong",[e._v("Professional ID:")]),e._v(" "+e._s(e.current_user?.id||"Unknown"))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Service Type:")]),e._v(" "+e._s(e.profile.service_type||"Not specified"))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Assigned Requests:")]),e._v(" "+e._s(e.serviceRequests.length))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Available Requests:")]),e._v(" "+e._s(e.availableCustomerRequests.length))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("API Errors:")]),e._v(" "+e._s(e.error||"None"))])])]),e.debugAllPendingRequests?t("div",{staticClass:"mt-3"},[t("h6",[e._v("All Pending Requests in System:")]),t("div",{staticClass:"alert alert-info"},[t("p",{staticClass:"mb-1"},[e._v("Total pending requests: "+e._s(e.debugAllPendingRequests.total_count))]),t("p",{staticClass:"mb-0"},[e._v("These are ALL pending requests in the system, regardless of service type.")])]),t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"table table-sm table-striped"},[e._m(7),t("tbody",e._l(e.debugAllPendingRequests.requests,(function(s){return t("tr",{key:s.id},[t("td",[e._v(e._s(s.id))]),t("td",[e._v(e._s(s.service_info?.name||"Unknown"))]),t("td",[e._v(e._s(s.service_info?.category||"Unknown"))]),t("td",[e._v(e._s(s.customer_info?.name||"Unknown"))]),t("td",[e._v(e._s(e.formatDate(s.created_at)))]),t("td",[t("button",{staticClass:"btn btn-success btn-sm",on:{click:function(t){return e.forceAcceptRequest(s.id)}}},[e._v(" Accept ")])])])})),0)])])]):e._e()]):e._e()])},i=[function(){var e=this,t=e._self._c;return t("div",[t("h5",{staticClass:"mb-0"},[e._v("Job Availability")]),t("p",{staticClass:"text-muted mb-0"},[e._v("Toggle your availability to receive new service requests")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"spinner-border text-primary",attrs:{role:"status"}},[t("span",{staticClass:"visually-hidden"},[e._v("Loading...")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"alert alert-warning"},[t("i",{staticClass:"fas fa-exclamation-triangle me-2"}),e._v(" You must confirm that you have exited the customer location before marking the service as completed. ")])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"form-check-label",attrs:{for:"exitedLocation"}},[t("strong",[e._v("I confirm that I have exited the customer location")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"alert alert-success"},[t("i",{staticClass:"fas fa-check-circle me-2"}),e._v(" You have marked this service as completed. Waiting for customer to close the service. ")])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"avatar-container mb-3"},[t("img",{staticClass:"rounded-circle img-thumbnail",attrs:{src:"https://via.placeholder.com/150",alt:"Profile"}})])},function(){var e=this,t=e._self._c;return t("h5",[t("i",{staticClass:"fas fa-exclamation-triangle me-2"}),e._v("Error Loading Dashboard")])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("ID")]),t("th",[e._v("Service")]),t("th",[e._v("Category")]),t("th",[e._v("Customer")]),t("th",[e._v("Created")]),t("th",[e._v("Actions")])])])}],r=s(844);const l={name:"ProfessionalDashboard",components:{},data(){return{professionalName:"",activeTab:"pending",loading:!0,serviceRequests:[],availableCustomerRequests:[],profile:{service_type:"",experience:0,average_rating:0,total_reviews:0,is_approved:!1,description:"",email:"",phone:"",date_created:(new Date).toISOString()},reviews:[],showDetailsModal:!1,showProfileModal:!1,selectedRequest:null,isAvailable:!0,updatingProfile:!1,profileForm:{description:"",phone:"",experience:0},error:null,isDevelopment:!1,current_user:null,debugAllPendingRequests:null}},computed:{pendingRequests(){return[...this.serviceRequests.filter((e=>"pending"===e.status)),...this.availableCustomerRequests]},inProgressRequests(){return this.serviceRequests.filter((e=>"in_progress"===e.status||"assigned"===e.status))||[]},completedRequests(){return this.serviceRequests.filter((e=>"completed"===e.status||"closed"===e.status))||[]},filteredRequests(){switch(this.activeTab){case"pending":return this.pendingRequests;case"assigned":return this.inProgressRequests;case"completed":return this.completedRequests;default:return[]}}},created(){this.fetchData()},methods:{checkAuth(){const e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user")||"{}");return this.current_user=t,e?"professional"!==t.role?(console.log("User is not a professional - redirecting"),setTimeout((()=>{this.$router.push("/login")}),100),!1):(this.professionalName=t.name||"Professional",!0):(console.log("No authentication token found - redirecting to login"),setTimeout((()=>{this.$router.push("/login")}),100),!1)},async fetchData(){try{if(!this.checkAuth())return;this.loading=!0,this.error=null;const e=localStorage.getItem("token");if(!e)throw new Error("Authentication required");await Promise.all([this.fetchProfile(),this.fetchRequests()])}catch(e){console.error("Dashboard data fetch error:",e),this.error=e.message||"Failed to load dashboard data",(e.message.includes("authentication")||e.message.includes("token"))&&setTimeout((()=>this.$router.push("/login")),1e3)}finally{this.loading=!1}},async fetchProfile(){try{const e=await r.Uo.getProfile();this.profile={...this.profile,...e},this.profileForm.description=e.description||"",this.profileForm.phone=e.phone||"",this.profileForm.experience=e.experience||0}catch(e){console.error("Failed to load profile data:",e)}},async fetchRequests(){try{this.loading=!0,this.serviceRequests=[],this.availableCustomerRequests=[];const s=localStorage.getItem("token");console.log("Using token for requests (first 10 chars):",s?s.substring(0,10)+"...":"No token"),console.log("Fetching assigned service requests...");try{const e=await r.Uo.getAssignments();console.log("Assigned requests response:",e),Array.isArray(e)?(this.serviceRequests=e.map((e=>({...e,service:e.service||{name:"Unknown Service",base_price:0},customer:e.customer_name||{customer_name:"Unknown Customer"}}))),console.log(`Loaded ${this.serviceRequests.length} assigned service requests`)):console.error("Invalid response format for assigned requests:",e)}catch(e){console.error("Error fetching assignments:",e),this.error="Failed to load your assigned service requests: "+(e.message||"Unknown error")}try{console.log("Fetching available service requests...");const e=await r.Uo.getAvailableRequests();console.log("Available requests response:",e),Array.isArray(e)?(this.availableCustomerRequests=e.map((e=>({...e,service:e.service||{name:"Unknown Service",base_price:0},customer:e.customer||{customer_name:"Unknown Customer"},isNewRequest:!0}))),console.log(`Loaded ${this.availableCustomerRequests.length} available customer requests`)):console.error("Invalid response format for available requests:",e)}catch(t){console.error("Failed to load available requests:",t),this.availableCustomerRequests=[]}this.serviceRequests.sort(((e,t)=>{const s=e.created_at?new Date(e.created_at):new Date(0),a=t.created_at?new Date(t.created_at):new Date(0);return a-s})),console.log(`Pending: ${this.pendingRequests.length}, In progress: ${this.inProgressRequests.length}, Completed: ${this.completedRequests.length}`)}catch(t){console.error("Failed to load service requests:",t),this.error="Failed to load service requests. Please try again later."}finally{this.loading=!1,this.fetchReviews()}},resetError(){this.error=null,this.fetchData()},isNewCustomerRequest(e){return e.isNewRequest||this.availableCustomerRequests.some((t=>t.id===e.id))},async fetchReviews(){try{console.log("Fetching professional reviews...");const e=await r.Uo.getReviews();Array.isArray(e)?(this.reviews=e,console.log(`Loaded ${this.reviews.length} reviews`)):(console.error("Invalid reviews response format:",e),this.reviews=[])}catch(e){console.error("Failed to load reviews:",e),this.reviews=[]}},async acceptRequest(e,t=!1){try{this.loading=!0,console.log(`Attempting to accept service request ${e}`);let s=this.serviceRequests.find((t=>t.id===e));if(s||(s=this.availableCustomerRequests.find((t=>t.id===e))),!s)throw new Error("Request not found");if("pending"!==s.status)return void alert("This request cannot be accepted in its current state.");console.log(`Calling API to update status of request ${e} to in_progress`),await r.Uo.updateStatus(e,"in_progress"),console.log("Status update API call completed successfully"),await this.fetchData(),t&&(this.showDetailsModal=!1),alert('Service request accepted successfully. You can find it in the "In Progress" tab.')}catch(s){console.error("Error accepting request:",s),alert("Failed to accept request: "+(s.message||"Unknown error"))}finally{this.loading=!1}},async rejectRequest(e,t=!1){if(confirm("Are you sure you want to reject this request?"))try{this.loading=!0;let s=this.serviceRequests.find((t=>t.id===e));if(s||(s=this.availableCustomerRequests.find((t=>t.id===e))),!s)throw new Error("Request not found");if("pending"!==s.status&&"available"!==s.status)return void alert("This request cannot be rejected in its current state.");const a=prompt("Please provide a reason for rejection (optional):");await r.Uo.updateStatus(e,"rejected"),a&&a.trim()&&await r.Uo.addRejectionReason(e,a),await this.fetchData(),t&&(this.showDetailsModal=!1),alert("Service request has been rejected.")}catch(s){console.error("Error rejecting request:",s),alert("Failed to reject request: "+(s.message||"Unknown error"))}finally{this.loading=!1}},async completeRequest(e,t=!1){try{this.loading=!0;const s=this.serviceRequests.find((t=>t.id===e));if(!s)throw new Error("Request not found");if("in_progress"!==s.status&&"assigned"!==s.status)return void alert("Only in-progress requests can be marked as completed.");let a=!1;if(t&&this.selectedRequest){if(!this.selectedRequest.exited_location)return alert("You must confirm you have exited the customer location before completing the service."),void(this.loading=!1);a=!0}else{if(!confirm("Have you exited the customer location? This is required before completing the service."))return void(this.loading=!1);a=!0}a&&(await r.Uo.confirmLocationExit(e),await r.Uo.updateStatus(e,"completed"),await this.fetchData(),t&&(this.showDetailsModal=!1),alert("Service request marked as completed successfully. The customer will be notified to close the service."))}catch(s){console.error("Error completing request:",s),alert("Failed to complete the request: "+(s.message||"Unknown error"))}finally{this.loading=!1}},viewRequestDetails(e){this.selectedRequest={...e,exited_location:e.exited_location||!1},this.showDetailsModal=!0},async updateAvailability(){try{await r.Uo.updateAvailability(this.isAvailable),alert(`You are now ${this.isAvailable?"available":"unavailable"} for new service requests.`)}catch(e){console.error("Error updating availability:",e),this.isAvailable=!this.isAvailable}},async updateProfile(){try{this.updatingProfile=!0,await r.Uo.updateProfile(this.profileForm),this.profile.description=this.profileForm.description,this.profile.phone=this.profileForm.phone,this.profile.experience=this.profileForm.experience,alert("Profile updated successfully!")}catch(e){console.error("Error updating profile:",e),alert("Failed to update profile. Please try again.")}finally{this.updatingProfile=!1}},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getStatusBadgeClass(e){const t={pending:"badge bg-warning",rejected:"badge bg-danger",in_progress:"badge bg-primary",assigned:"badge bg-info",completed:"badge bg-success",closed:"badge bg-secondary"};return t[e]||"badge bg-secondary"},getEmptyStateMessage(){return"pending"===this.activeTab?"No new service requests available at the moment. Check back later.":"assigned"===this.activeTab?"You have no active service assignments.":"You have not completed any service requests yet."},async refreshRequests(){try{console.log("Manually refreshing requests..."),this.loading=!0;const e=await r.Uo.getProfile();console.log("Professional profile:",e),await this.fetchRequests(),console.log("Refresh completed")}catch(e){console.error("Error refreshing requests:",e),this.error=`Error refreshing: ${e.message}`}finally{this.loading=!1}},async refreshAllPendingRequests(){try{this.loading=!0,console.log("Fetching ALL pending requests (debug mode)");const e=await r.Uo.getAllPendingRequests();this.debugAllPendingRequests=e,console.log("All pending requests:",this.debugAllPendingRequests)}catch(e){console.error("Error fetching all pending requests:",e),this.error=`Error: ${e.message}`}finally{this.loading=!1}},async forceAcceptRequest(e){if(confirm(`Are you sure you want to accept request #${e}?`))try{this.loading=!0,console.log(`Force-accepting request ${e}...`),await r.Uo.updateStatus(e,"in_progress"),alert(`Request #${e} accepted successfully!`),await this.fetchRequests(),await this.refreshAllPendingRequests()}catch(t){console.error("Error force-accepting request:",t),alert(`Error: ${t.message}`)}finally{this.loading=!1}}},mounted(){}},o=l;var c=s(656),n=(0,c.A)(o,a,i,!1,null,"4512f54d",null);const d=n.exports}}]);
"use strict";(self["webpackChunkhousehold_services"]=self["webpackChunkhousehold_services"]||[]).push([[796],{20:(e,t,s)=>{s.d(t,{Er:()=>d,Uo:()=>l,YR:()=>i,xZ:()=>n,y1:()=>c});var a=s(713),r=s(221);const o=a.A.create({baseURL:"http://localhost:8080",headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});o.interceptors.request.use((e=>{const t=localStorage.getItem("token");if(t){const s=t.startsWith("Bearer ")?t:`Bearer ${t}`;e.headers["Authorization"]=s,console.log(`Request to ${e.url} with token: ${s.substring(0,20)}...`)}else console.warn(`No token found for request to: ${e.url}`);return e}),(e=>(console.error("Request error:",e),Promise.reject(e)))),o.interceptors.response.use((e=>e),(e=>{if(console.error("Response error:",e.response?.data||e.message),e.response){switch(e.response.status){case 401:localStorage.removeItem("token"),localStorage.removeItem("user"),r.A.push("/login");break;case 403:r.A.push("/");break;case 500:console.error("Server error:",e.response.data);break}if(e.response.data&&e.response.data.message)return Promise.reject(new Error(e.response.data.message))}return Promise.reject(e)}));const c={async register(e){try{if("professional"===e.role&&!e.service_type)throw new Error("Professionals must select a service type.");console.log("Sending registration data:",e);const t=await o.post("/auth/register",e);return console.log("Registration response:",t.data),t.data}catch(t){throw console.error("Registration error:",t.response?.data||t.message),t.response?.data||{message:"Registration failed. Please try again."}}},async login(e){try{console.log("Attempting login:",e);const t=await o.post("/auth/login",e);if(console.log("Login response:",t.data),t.data.token){const e=t.data.token;localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t.data.user));const s=localStorage.getItem("token");console.log("Token saved successfully: "+(s?"Yes":"No")),console.log(`Saved token (first 15 chars): ${s?s.substring(0,15):"None"}`),console.log("localStorage.token:",localStorage.getItem("token")),console.log("localStorage.user:",localStorage.getItem("user")),setTimeout((()=>{r.A.push(`/${t.data.user.role}/dashboard`)}),500)}return t.data}catch(t){throw console.error("Login error:",t.response?.data||t.message),t}},async logout(){try{await o.post("/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),r.A.push("/login")}catch(e){console.error("Logout error:",e.response?.data||e.message),localStorage.removeItem("token"),localStorage.removeItem("user"),r.A.push("/login")}},getCurrentUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null}},i={async getServices(e={}){try{const t=await o.get("/api/admin/services",{params:e});return t.data}catch(t){throw console.error("Error fetching services:",t),t}},async mounted(){try{this.services=await this.searchServices(),console.log("Services loaded:",this.services)}catch(e){console.error("Failed to load services:",e)}},async getServiceById(e){try{const t=await o.get(`/api/services/${e}`);return t.data}catch(t){throw console.error("Error fetching service:",t),t}}},n={async getRequests(){try{const e=await o.get("/api/customer/requests");return e.data}catch(e){throw console.error("Error fetching requests:",e),e}},async createRequest(e){try{const t=await o.post("/api/customer/requests",e);return t.data}catch(t){throw console.error("Error creating request:",t),t}},async updateRequest(e,t){try{const s=await o.put(`/api/customer/requests/${e}`,t);return s.data}catch(s){throw console.error("Error updating request:",s),s}},async closeRequest(e){try{const t=await o.put(`/api/customer/requests/${e}/close`);return t.data}catch(t){throw console.error("Error closing request:",t),t}},async addReview(e,t){try{const s=await o.post(`/api/customer/requests/${e}/review`,t);return s.data}catch(s){throw console.error("Error adding review:",s),s}}},l={async getAssignments(e=null){try{console.log("Fetching professional assignments",e?`with status: ${e}`:"");const t=e?{status:e}:{},s=await o.get("/api/professional/assignments",{params:t});return console.log("Received assignments:",s.data.length),s.data}catch(t){throw console.error("Error fetching assignments:",t),t}},async updateStatus(e,t){try{console.log(`Updating request ${e} status to ${t}`);const s=await o.put(`/api/professional/requests/${e}`,{status:t});return console.log("Status update response:",s.data),s.data}catch(s){throw console.error("Error updating status:",s),s}},async getProfile(){try{console.log("Fetching professional profile");const e=await o.get("/api/professional/profile");return console.log("Retrieved profile data"),e.data}catch(e){throw console.error("Error fetching profile:",e),e}},async updateProfile(e){try{console.log("Updating professional profile with data:",e);const t=await o.put("/api/professional/profile",e);return console.log("Profile update response:",t.data),t.data}catch(t){throw console.error("Error updating profile:",t),t}}},d={async getUsers(e=null){try{const t=localStorage.getItem("token");console.log("Fetching users with token: "+(t?t.substring(0,15)+"...":"No token!"));const s=e?{role:e}:{};await new Promise((e=>setTimeout(e,300)));const a=await o.get("/api/admin/users",{params:s,headers:{Authorization:`Bearer ${t}`}});return console.log("Users response:",a.data),a.data}catch(t){throw console.error("Error fetching users:",t.response?.data||t.message),t}},async approveUser(e){try{console.log(`Approving professional with ID: ${e}`);const t=await o.post(`/api/admin/professionals/${e}/approve`);return console.log("Professional approved:",t.data),t.data}catch(t){throw console.error("Error approving user:",t),t}},async blockUser(e,t="Violation of terms of service"){try{console.log(`Blocking user with ID: ${e}, reason: ${t}`);const s=await o.post(`/api/admin/users/${e}/block`,{reason:t});return console.log("User blocked:",s.data),s.data}catch(s){throw console.error("Error blocking user:",s),s}},async unblockUser(e){try{console.log(`Unblocking user with ID: ${e}`);const t=await o.post(`/api/admin/users/${e}/unblock`);return console.log("User unblocked:",t.data),t.data}catch(t){throw console.error("Error unblocking user:",t),t}},async getServices(){try{const e=localStorage.getItem("token");console.log("Fetching services with token: "+(e?e.substring(0,15)+"...":"No token!")),await new Promise((e=>setTimeout(e,300)));const t=await o.get("/api/admin/services",{headers:{Authorization:`Bearer ${e}`}});return console.log("Services response:",t.data),t.data}catch(e){throw console.error("Error fetching services:",e.response?.data||e.message),e}},async createService(e){try{console.log("Creating service with data:",e);const t=await o.post("/api/admin/services",e);return console.log("Service created:",t.data),t.data}catch(t){throw console.error("Error creating service:",t.response?.data||t),t}},async updateService(e,t){try{const s=await o.put(`/api/admin/services/${e}`,t);return s.data}catch(s){throw console.error("Error updating service:",s),s}},async deleteService(e){try{const t=await o.delete(`/api/admin/services/${e}`);return t.data}catch(t){throw console.error("Error deleting service:",t),t}}}},796:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"professional-dashboard"},[t("div",{staticClass:"container py-4"},[t("div",{staticClass:"row mb-4"},[t("div",{staticClass:"col-lg-8"},[t("h2",[e._v("Welcome, "+e._s(e.professionalName)+"!")]),t("p",{staticClass:"text-muted"},[e._v("Manage your service assignments and view customer requests")]),t("div",{staticClass:"stats-cards row g-3 mt-3"},[t("div",{staticClass:"col-md-4"},[t("div",{staticClass:"card bg-primary text-white"},[t("div",{staticClass:"card-body"},[t("h6",{staticClass:"card-title"},[e._v("Pending Requests")]),t("h3",{staticClass:"mb-0"},[e._v(e._s(e.pendingRequests.length))])])])]),t("div",{staticClass:"col-md-4"},[t("div",{staticClass:"card bg-success text-white"},[t("div",{staticClass:"card-body"},[t("h6",{staticClass:"card-title"},[e._v("In Progress")]),t("h3",{staticClass:"mb-0"},[e._v(e._s(e.inProgressRequests.length))])])])]),t("div",{staticClass:"col-md-4"},[t("div",{staticClass:"card bg-info text-white"},[t("div",{staticClass:"card-body"},[t("h6",{staticClass:"card-title"},[e._v("Completed")]),t("h3",{staticClass:"mb-0"},[e._v(e._s(e.completedRequests.length))])])])])])]),t("div",{staticClass:"col-lg-4 mt-4 mt-lg-0"},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-body"},[t("h5",{staticClass:"card-title"},[e._v("Your Service Profile")]),t("div",{staticClass:"d-flex align-items-center mb-3"},[t("div",{staticClass:"rating me-2"},e._l(5,(function(s){return t("i",{key:s,staticClass:"fas fa-star",class:s<=Math.round(e.profile.average_rating)?"text-warning":"text-muted"})})),0),t("span",[e._v(e._s(e.profile.average_rating)+" / 5 ("+e._s(e.profile.total_reviews)+" reviews)")])]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Service:")]),e._v(" "+e._s(e.profile.service_type))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Experience:")]),e._v(" "+e._s(e.profile.experience)+" years")]),t("p",{staticClass:"mb-0"},[t("strong",[e._v("Status:")]),t("span",{staticClass:"badge",class:e.profile.is_approved?"bg-success":"bg-warning"},[e._v(" "+e._s(e.profile.is_approved?"Approved":"Pending Approval")+" ")])])])])])]),t("ul",{staticClass:"nav nav-tabs mb-4"},[t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"pending"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="pending"}}},[t("i",{staticClass:"fas fa-clock me-1"}),e._v(" New Requests ")])]),t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"assigned"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="assigned"}}},[t("i",{staticClass:"fas fa-tools me-1"}),e._v(" In Progress ")])]),t("li",{staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:"completed"===e.activeTab},attrs:{href:"#"},on:{click:function(t){t.preventDefault(),e.activeTab="completed"}}},[t("i",{staticClass:"fas fa-check-circle me-1"}),e._v(" Completed ")])])]),e.loading?t("div",{staticClass:"text-center my-5"},[e._m(0),t("p",{staticClass:"mt-2"},[e._v("Loading service requests...")])]):0===e.filteredRequests.length?t("div",{staticClass:"text-center py-5"},[t("i",{staticClass:"fas fa-inbox fa-3x text-muted mb-3"}),t("h5",[e._v("No service requests found")]),t("p",{staticClass:"text-muted"},[e._v(e._s(e.getEmptyStateMessage()))])]):t("div",{staticClass:"row g-4"},e._l(e.filteredRequests,(function(s){return t("div",{key:s.id,staticClass:"col-md-6"},[t("div",{staticClass:"card h-100"},[t("div",{staticClass:"card-header d-flex justify-content-between align-items-center"},[t("span",{class:e.getStatusBadgeClass(s.status)},[e._v(" "+e._s(s.status)+" ")]),t("span",{staticClass:"text-muted small"},[t("i",{staticClass:"fas fa-calendar me-1"}),e._v(" "+e._s(e.formatDate(s.created_at))+" ")])]),t("div",{staticClass:"card-body"},[t("h5",{staticClass:"card-title"},[e._v(e._s(s.service.name))]),t("p",{staticClass:"card-text"},[t("strong",[e._v("Customer:")]),e._v(" "+e._s(s.customer.customer_name)+" ")]),t("p",{staticClass:"card-text"},[t("strong",[e._v("Location:")]),e._v(" PIN Code "+e._s(s.pin_code)+" ")]),t("div",{staticClass:"mb-3"},[t("strong",[e._v("Instructions:")]),t("p",{staticClass:"mb-0"},[e._v(e._s(s.special_instructions||"No special instructions"))])]),t("div",{staticClass:"d-flex justify-content-end gap-2"},["pending"===s.status?[t("button",{staticClass:"btn btn-success btn-sm",on:{click:function(t){return e.acceptRequest(s.id)}}},[t("i",{staticClass:"fas fa-check me-1"}),e._v(" Accept ")]),t("button",{staticClass:"btn btn-danger btn-sm",on:{click:function(t){return e.rejectRequest(s.id)}}},[t("i",{staticClass:"fas fa-times me-1"}),e._v(" Reject ")])]:e._e(),"in_progress"===s.status?t("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.completeRequest(s.id)}}},[t("i",{staticClass:"fas fa-check-circle me-1"}),e._v(" Mark as Completed ")]):e._e(),t("button",{staticClass:"btn btn-outline-secondary btn-sm",on:{click:function(t){return e.viewRequestDetails(s)}}},[t("i",{staticClass:"fas fa-eye me-1"}),e._v(" Details ")])],2)]),"completed"===s.status?t("div",{staticClass:"card-footer text-muted"},[s.review?t("div",{staticClass:"mt-2"},[t("strong",[e._v("Customer Review:")]),t("div",{staticClass:"d-flex align-items-center"},[t("div",{staticClass:"rating me-2"},e._l(5,(function(e){return t("i",{key:e,staticClass:"fas fa-star",class:e<=s.review.rating?"text-warning":"text-muted"})})),0),t("span",[e._v(e._s(s.review.remarks))])])]):t("div",[t("i",{staticClass:"fas fa-star-half-alt me-1"}),e._v(" Awaiting customer review ")])]):e._e()])])})),0)]),e.showDetailsModal?t("div",{staticClass:"modal fade",class:{show:e.showDetailsModal}},[t("div",{staticClass:"modal-dialog"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h5",{staticClass:"modal-title"},[e._v("Request Details")]),t("button",{staticClass:"btn-close",attrs:{type:"button"},on:{click:function(t){e.showDetailsModal=!1}}})]),e.selectedRequest?t("div",{staticClass:"modal-body"},[t("div",{staticClass:"mb-3"},[t("h6",[e._v("Service Information")]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Service:")]),e._v(" "+e._s(e.selectedRequest.service.name))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Price:")]),e._v(" ₹"+e._s(e.selectedRequest.service.base_price))]),t("p",[t("strong",[e._v("Status:")]),t("span",{class:e.getStatusBadgeClass(e.selectedRequest.status)},[e._v(" "+e._s(e.selectedRequest.status)+" ")])])]),t("div",{staticClass:"mb-3"},[t("h6",[e._v("Customer Information")]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Name:")]),e._v(" "+e._s(e.selectedRequest.customer.customer_name))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("Phone:")]),e._v(" "+e._s(e.selectedRequest.customer.phone))]),t("p",{staticClass:"mb-1"},[t("strong",[e._v("PIN Code:")]),e._v(" "+e._s(e.selectedRequest.pin_code))]),t("p",{staticClass:"mb-0"},[t("strong",[e._v("Address:")]),e._v(" "+e._s(e.selectedRequest.customer.address)+" ")])]),t("div",{staticClass:"mb-3"},[t("h6",[e._v("Timeline")]),t("ul",{staticClass:"timeline"},[t("li",{staticClass:"mb-2"},[t("strong",[e._v("Created:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.created_at)))]),e.selectedRequest.accepted_at?t("li",{staticClass:"mb-2"},[t("strong",[e._v("Accepted:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.accepted_at))+" ")]):e._e(),e.selectedRequest.completed_at?t("li",{staticClass:"mb-2"},[t("strong",[e._v("Completed:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.completed_at))+" ")]):e._e(),e.selectedRequest.closed_at?t("li",[t("strong",[e._v("Closed:")]),e._v(" "+e._s(e.formatDate(e.selectedRequest.closed_at))+" ")]):e._e()])]),t("div",{staticClass:"mb-0"},[t("h6",[e._v("Special Instructions")]),t("p",{staticClass:"mb-0"},[e._v(e._s(e.selectedRequest.special_instructions||"No special instructions provided."))])])]):e._e(),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(t){e.showDetailsModal=!1}}},[e._v("Close")]),e.selectedRequest&&"pending"===e.selectedRequest.status?[t("button",{staticClass:"btn btn-success",on:{click:function(t){return e.acceptRequest(e.selectedRequest.id,!0)}}},[t("i",{staticClass:"fas fa-check me-1"}),e._v(" Accept ")]),t("button",{staticClass:"btn btn-danger",on:{click:function(t){return e.rejectRequest(e.selectedRequest.id,!0)}}},[t("i",{staticClass:"fas fa-times me-1"}),e._v(" Reject ")])]:e._e(),e.selectedRequest&&"in_progress"===e.selectedRequest.status?t("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.completeRequest(e.selectedRequest.id,!0)}}},[t("i",{staticClass:"fas fa-check-circle me-1"}),e._v(" Mark as Completed ")]):e._e()],2)])])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"spinner-border text-primary",attrs:{role:"status"}},[t("span",{staticClass:"visually-hidden"},[e._v("Loading...")])])}],o=s(464),c=s(20);const i={name:"ProfessionalDashboard",setup(){const e=JSON.parse(localStorage.getItem("user")||"{}"),t=(0,o.KR)(e.name||"Professional"),s=(0,o.KR)("pending"),a=(0,o.KR)(!0),r=(0,o.KR)([]),i=(0,o.KR)({service_type:"",experience:0,average_rating:0,total_reviews:0,is_approved:!1}),n=(0,o.KR)(!1),l=(0,o.KR)(null),d=(0,o.EW)((()=>r.value.filter((e=>"pending"===e.status)))),u=(0,o.EW)((()=>r.value.filter((e=>"in_progress"===e.status||"assigned"===e.status)))),g=(0,o.EW)((()=>r.value.filter((e=>"completed"===e.status||"closed"===e.status)))),v=(0,o.EW)((()=>"pending"===s.value?d.value:"assigned"===s.value?u.value:"completed"===s.value?g.value:[])),p=async()=>{a.value=!0;try{const[e,t]=await Promise.all([c.Uo.getAssignments(),c.Uo.getProfile()]);r.value=e,i.value=t}catch(e){console.error("Error fetching dashboard data:",e)}finally{a.value=!1}},m=async(e,t=!1)=>{try{await c.Uo.updateStatus(e,"in_progress"),await p(),t&&(n.value=!1)}catch(s){console.error("Error accepting request:",s)}},h=async(e,t=!1)=>{if(confirm("Are you sure you want to reject this request?"))try{await c.Uo.updateStatus(e,"rejected"),await p(),t&&(n.value=!1)}catch(s){console.error("Error rejecting request:",s)}},_=async(e,t=!1)=>{try{await c.Uo.updateStatus(e,"completed"),await p(),t&&(n.value=!1)}catch(s){console.error("Error completing request:",s)}},f=e=>{l.value=e,n.value=!0},C=e=>{if(!e)return"N/A";const t=new Date(e);return t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},b=e=>{const t={pending:"badge bg-warning",rejected:"badge bg-danger",in_progress:"badge bg-primary",assigned:"badge bg-info",completed:"badge bg-success",closed:"badge bg-secondary"};return t[e]||"badge bg-secondary"},w=()=>"pending"===s.value?"No new service requests available at the moment. Check back later.":"assigned"===s.value?"You have no active service assignments.":"You have not completed any service requests yet.";return(0,o.sV)(p),{professionalName:t,activeTab:s,loading:a,serviceRequests:r,profile:i,pendingRequests:d,inProgressRequests:u,completedRequests:g,filteredRequests:v,showDetailsModal:n,selectedRequest:l,acceptRequest:m,rejectRequest:h,completeRequest:_,viewRequestDetails:f,formatDate:C,getStatusBadgeClass:b,getEmptyStateMessage:w}}},n=i;var l=s(656),d=(0,l.A)(n,a,r,!1,null,"4ffa25aa",null);const u=d.exports}}]);
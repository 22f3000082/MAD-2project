"use strict";(self["webpackChunkhousehold_services"]=self["webpackChunkhousehold_services"]||[]).push([[345],{20:(e,s,r)=>{r.d(s,{Er:()=>d,Uo:()=>l,YR:()=>n,xZ:()=>c,y1:()=>i});var t=r(713),a=r(221);const o=t.A.create({baseURL:"http://localhost:8080",headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});o.interceptors.request.use((e=>{const s=localStorage.getItem("token");if(s){const r=s.startsWith("Bearer ")?s:`Bearer ${s}`;e.headers["Authorization"]=r,console.log(`Request to ${e.url} with token: ${r.substring(0,20)}...`)}else console.warn(`No token found for request to: ${e.url}`);return e}),(e=>(console.error("Request error:",e),Promise.reject(e)))),o.interceptors.response.use((e=>e),(e=>{if(console.error("Response error:",e.response?.data||e.message),e.response){switch(e.response.status){case 401:localStorage.removeItem("token"),localStorage.removeItem("user"),a.A.push("/login");break;case 403:a.A.push("/");break;case 500:console.error("Server error:",e.response.data);break}if(e.response.data&&e.response.data.message)return Promise.reject(new Error(e.response.data.message))}return Promise.reject(e)}));const i={async register(e){try{if("professional"===e.role&&!e.service_type)throw new Error("Professionals must select a service type.");console.log("Sending registration data:",e);const s=await o.post("/auth/register",e);return console.log("Registration response:",s.data),s.data}catch(s){throw console.error("Registration error:",s.response?.data||s.message),s.response?.data||{message:"Registration failed. Please try again."}}},async login(e){try{console.log("Attempting login:",e);const s=await o.post("/auth/login",e);if(console.log("Login response:",s.data),s.data.token){const e=s.data.token;localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(s.data.user));const r=localStorage.getItem("token");console.log("Token saved successfully: "+(r?"Yes":"No")),console.log(`Saved token (first 15 chars): ${r?r.substring(0,15):"None"}`),console.log("localStorage.token:",localStorage.getItem("token")),console.log("localStorage.user:",localStorage.getItem("user")),setTimeout((()=>{a.A.push(`/${s.data.user.role}/dashboard`)}),500)}return s.data}catch(s){throw console.error("Login error:",s.response?.data||s.message),s}},async logout(){try{await o.post("/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user"),a.A.push("/login")}catch(e){console.error("Logout error:",e.response?.data||e.message),localStorage.removeItem("token"),localStorage.removeItem("user"),a.A.push("/login")}},getCurrentUser(){const e=localStorage.getItem("user");return e?JSON.parse(e):null}},n={async getServices(e={}){try{const s=await o.get("/api/admin/services",{params:e});return s.data}catch(s){throw console.error("Error fetching services:",s),s}},async mounted(){try{this.services=await this.searchServices(),console.log("Services loaded:",this.services)}catch(e){console.error("Failed to load services:",e)}},async getServiceById(e){try{const s=await o.get(`/api/services/${e}`);return s.data}catch(s){throw console.error("Error fetching service:",s),s}}},c={async getRequests(){try{const e=await o.get("/api/customer/requests");return e.data}catch(e){throw console.error("Error fetching requests:",e),e}},async createRequest(e){try{const s=await o.post("/api/customer/requests",e);return s.data}catch(s){throw console.error("Error creating request:",s),s}},async updateRequest(e,s){try{const r=await o.put(`/api/customer/requests/${e}`,s);return r.data}catch(r){throw console.error("Error updating request:",r),r}},async closeRequest(e){try{const s=await o.put(`/api/customer/requests/${e}/close`);return s.data}catch(s){throw console.error("Error closing request:",s),s}},async addReview(e,s){try{const r=await o.post(`/api/customer/requests/${e}/review`,s);return r.data}catch(r){throw console.error("Error adding review:",r),r}}},l={async getAssignments(e=null){try{console.log("Fetching professional assignments",e?`with status: ${e}`:"");const s=e?{status:e}:{},r=await o.get("/api/professional/assignments",{params:s});return console.log("Received assignments:",r.data.length),r.data}catch(s){throw console.error("Error fetching assignments:",s),s}},async updateStatus(e,s){try{console.log(`Updating request ${e} status to ${s}`);const r=await o.put(`/api/professional/requests/${e}`,{status:s});return console.log("Status update response:",r.data),r.data}catch(r){throw console.error("Error updating status:",r),r}},async getProfile(){try{console.log("Fetching professional profile");const e=await o.get("/api/professional/profile");return console.log("Retrieved profile data"),e.data}catch(e){throw console.error("Error fetching profile:",e),e}},async updateProfile(e){try{console.log("Updating professional profile with data:",e);const s=await o.put("/api/professional/profile",e);return console.log("Profile update response:",s.data),s.data}catch(s){throw console.error("Error updating profile:",s),s}}},d={async getUsers(e=null){try{const s=localStorage.getItem("token");console.log("Fetching users with token: "+(s?s.substring(0,15)+"...":"No token!"));const r=e?{role:e}:{};await new Promise((e=>setTimeout(e,300)));const t=await o.get("/api/admin/users",{params:r,headers:{Authorization:`Bearer ${s}`}});return console.log("Users response:",t.data),t.data}catch(s){throw console.error("Error fetching users:",s.response?.data||s.message),s}},async approveUser(e){try{console.log(`Approving professional with ID: ${e}`);const s=await o.post(`/api/admin/professionals/${e}/approve`);return console.log("Professional approved:",s.data),s.data}catch(s){throw console.error("Error approving user:",s),s}},async blockUser(e,s="Violation of terms of service"){try{console.log(`Blocking user with ID: ${e}, reason: ${s}`);const r=await o.post(`/api/admin/users/${e}/block`,{reason:s});return console.log("User blocked:",r.data),r.data}catch(r){throw console.error("Error blocking user:",r),r}},async unblockUser(e){try{console.log(`Unblocking user with ID: ${e}`);const s=await o.post(`/api/admin/users/${e}/unblock`);return console.log("User unblocked:",s.data),s.data}catch(s){throw console.error("Error unblocking user:",s),s}},async getServices(){try{const e=localStorage.getItem("token");console.log("Fetching services with token: "+(e?e.substring(0,15)+"...":"No token!")),await new Promise((e=>setTimeout(e,300)));const s=await o.get("/api/admin/services",{headers:{Authorization:`Bearer ${e}`}});return console.log("Services response:",s.data),s.data}catch(e){throw console.error("Error fetching services:",e.response?.data||e.message),e}},async createService(e){try{console.log("Creating service with data:",e);const s=await o.post("/api/admin/services",e);return console.log("Service created:",s.data),s.data}catch(s){throw console.error("Error creating service:",s.response?.data||s),s}},async updateService(e,s){try{const r=await o.put(`/api/admin/services/${e}`,s);return r.data}catch(r){throw console.error("Error updating service:",r),r}},async deleteService(e){try{const s=await o.delete(`/api/admin/services/${e}`);return s.data}catch(s){throw console.error("Error deleting service:",s),s}}}},345:(e,s,r)=>{r.r(s),r.d(s,{default:()=>d});var t=function(){var e=this,s=e._self._c;return s("div",{staticClass:"login-container"},[s("div",{staticClass:"container py-5"},[s("div",{staticClass:"row justify-content-center"},[s("div",{staticClass:"col-md-6 col-lg-5"},[s("div",{staticClass:"card shadow"},[s("div",{staticClass:"card-body p-4"},[s("h2",{staticClass:"text-center mb-4"},[e._v("Login")]),s("form",{staticClass:"needs-validation",attrs:{novalidate:""},on:{submit:function(s){return s.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[s("div",{staticClass:"mb-3"},[s("label",{staticClass:"form-label"},[e._v("Email")]),s("div",{staticClass:"input-group"},[e._m(0),s("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.email,expression:"formData.email"}],staticClass:"form-control",class:{"is-invalid":e.errors.email},attrs:{type:"email",required:"",placeholder:"Enter your email",autocomplete:"email"},domProps:{value:e.formData.email},on:{input:function(s){s.target.composing||e.$set(e.formData,"email",s.target.value)}}}),s("div",{staticClass:"invalid-feedback"},[e._v(e._s(e.errors.email))])])]),s("div",{staticClass:"mb-4"},[s("label",{staticClass:"form-label"},[e._v("Password")]),s("div",{staticClass:"input-group"},[e._m(1),"checkbox"===(e.showPassword?"text":"password")?s("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.password,expression:"formData.password"}],staticClass:"form-control",class:{"is-invalid":e.errors.password},attrs:{required:"",placeholder:"Enter your password",autocomplete:"current-password",type:"checkbox"},domProps:{checked:Array.isArray(e.formData.password)?e._i(e.formData.password,null)>-1:e.formData.password},on:{change:function(s){var r=e.formData.password,t=s.target,a=!!t.checked;if(Array.isArray(r)){var o=null,i=e._i(r,o);t.checked?i<0&&e.$set(e.formData,"password",r.concat([o])):i>-1&&e.$set(e.formData,"password",r.slice(0,i).concat(r.slice(i+1)))}else e.$set(e.formData,"password",a)}}}):"radio"===(e.showPassword?"text":"password")?s("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.password,expression:"formData.password"}],staticClass:"form-control",class:{"is-invalid":e.errors.password},attrs:{required:"",placeholder:"Enter your password",autocomplete:"current-password",type:"radio"},domProps:{checked:e._q(e.formData.password,null)},on:{change:function(s){return e.$set(e.formData,"password",null)}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.password,expression:"formData.password"}],staticClass:"form-control",class:{"is-invalid":e.errors.password},attrs:{required:"",placeholder:"Enter your password",autocomplete:"current-password",type:e.showPassword?"text":"password"},domProps:{value:e.formData.password},on:{input:function(s){s.target.composing||e.$set(e.formData,"password",s.target.value)}}}),s("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button"},on:{click:e.togglePassword}},[s("i",{class:e.showPassword?"fas fa-eye-slash":"fas fa-eye"})]),s("div",{staticClass:"invalid-feedback"},[e._v(e._s(e.errors.password))])])]),e.loginError?s("div",{staticClass:"alert alert-danger",attrs:{role:"alert"}},[s("i",{staticClass:"fas fa-exclamation-circle me-2"}),e._v(" "+e._s(e.loginError)+" ")]):e._e(),s("div",{staticClass:"d-grid gap-2"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:e.isLoading}},[e.isLoading?s("span",{staticClass:"spinner-border spinner-border-sm me-2"}):e._e(),e._v(" "+e._s(e.isLoading?"Logging in...":"Login")+" ")])]),s("p",{staticClass:"text-center mt-3"},[e._v(" Don't have an account? "),s("router-link",{attrs:{to:"/register"}},[e._v("Register here")])],1)])])]),e._m(2)])])])])},a=[function(){var e=this,s=e._self._c;return s("span",{staticClass:"input-group-text"},[s("i",{staticClass:"fas fa-envelope"})])},function(){var e=this,s=e._self._c;return s("span",{staticClass:"input-group-text"},[s("i",{staticClass:"fas fa-lock"})])},function(){var e=this,s=e._self._c;return s("div",{staticClass:"row mt-4 g-3"},[s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"card h-100 border-0 shadow-sm"},[s("div",{staticClass:"card-body text-center"},[s("i",{staticClass:"fas fa-user fa-2x text-success mb-2"}),s("h5",{staticClass:"card-title"},[e._v("Customer")]),s("p",{staticClass:"card-text small"},[e._v("Book and manage services")])])])]),s("div",{staticClass:"col-md-4"},[s("div",{staticClass:"card h-100 border-0 shadow-sm"},[s("div",{staticClass:"card-body text-center"},[s("i",{staticClass:"fas fa-user-tie fa-2x text-info mb-2"}),s("h5",{staticClass:"card-title"},[e._v("Professional")]),s("p",{staticClass:"card-text small"},[e._v("Provide services")])])])])])}],o=r(20);const i={name:"LoginView",data(){return{formData:{email:"",password:""},errors:{},loginError:"",isLoading:!1,showPassword:!1}},methods:{togglePassword(){this.showPassword=!this.showPassword},validateForm(){this.errors={};let e=!0;return this.formData.email?/\S+@\S+\.\S+/.test(this.formData.email)||(this.errors.email="Please enter a valid email address",e=!1):(this.errors.email="Email is required",e=!1),this.formData.password||(this.errors.password="Password is required",e=!1),e},async handleSubmit(){if(this.loginError="",this.validateForm()){this.isLoading=!0;try{const e=await o.y1.login(this.formData);switch(e.user.role){case"admin":await this.$router.push("/admin/dashboard");break;case"customer":await this.$router.push("/customer/dashboard");break;case"professional":if(!e.user.is_approved)return this.loginError="Your account is pending approval. Please wait for admin verification.",localStorage.removeItem("token"),void localStorage.removeItem("user");await this.$router.push("/professional/dashboard");break;default:await this.$router.push("/")}}catch(e){console.error("Login error:",e),401===e.response?.status?this.loginError="Invalid email or password":e.message?this.loginError=e.message:this.loginError="Network error. Please check your connection and try again."}finally{this.isLoading=!1}}}},created(){localStorage.removeItem("token"),localStorage.removeItem("user")}},n=i;var c=r(656),l=(0,c.A)(n,t,a,!1,null,"27d1be89",null);const d=l.exports}}]);
{"ast":null,"code":"import { serviceAPI, customerAPI } from '@/services/api';\nimport ServiceSearchPanel from '@/components/ServiceSearchPanel.vue';\nimport ServiceList from '@/components/ServiceList.vue';\nimport ServiceReviewForm from '@/components/ServiceReviewForm.vue';\nexport default {\n  name: 'CustomerDashboard',\n  components: {\n    ServiceSearchPanel,\n    ServiceList,\n    ServiceReviewForm\n  },\n  data() {\n    const user = JSON.parse(localStorage.getItem('user')) || {};\n    return {\n      userName: user.name || user.username || 'Customer',\n      activeSection: 'browse',\n      activeTab: 'active',\n      showServiceModal: false,\n      showNewRequestModal: false,\n      showReviewModal: false,\n      showRequestDetailsModal: false,\n      selectedService: null,\n      selectedRequest: null,\n      searchQuery: {\n        name: '',\n        category: '',\n        pinCode: ''\n      },\n      services: [],\n      categories: ['AC Repair', 'Plumbing', 'Electrical', 'Carpentry', 'Painting', 'Cleaning', 'Pest Control', 'Appliance Repair', 'Moving Services', 'Gardening'],\n      serviceRequests: [],\n      loading: false,\n      error: null,\n      newRequest: {\n        service_id: '',\n        pin_code: '',\n        special_instructions: '',\n        category: ''\n      },\n      isLoading: false,\n      page: 1,\n      hasMoreServices: true,\n      showAdvancedSearch: false\n    };\n  },\n  computed: {\n    filteredRequests() {\n      return this.serviceRequests.filter(request => {\n        if (this.activeTab === 'active') {\n          return ['pending', 'assigned', 'in_progress'].includes(request.status);\n        } else {\n          return ['completed', 'closed'].includes(request.status);\n        }\n      });\n    },\n    filteredServices() {\n      if (!this.services.length) return [];\n      return this.services.filter(service => {\n        // Filter by name\n        if (this.searchQuery.name && !service.name.toLowerCase().includes(this.searchQuery.name.toLowerCase())) {\n          return false;\n        }\n\n        // Filter by category\n        if (this.searchQuery.category && service.category !== this.searchQuery.category) {\n          return false;\n        }\n\n        // Filter by PIN code if implemented\n        if (this.searchQuery.pinCode && service.available_pin_codes) {\n          if (!service.available_pin_codes.includes(this.searchQuery.pinCode)) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n  },\n  methods: {\n    async fetchServices() {\n      try {\n        this.loading = true;\n        console.log('CustomerDashboard: Fetching services...');\n        // Use adminAPI to fetch services, as we need full service list for browsing\n        const response = await serviceAPI.getServices();\n        console.log(`CustomerDashboard: Received ${response ? response.length : 0} services`);\n        this.services = response || [];\n        this.loading = false;\n      } catch (error) {\n        console.error('CustomerDashboard: Error fetching services:', error);\n        this.error = 'Failed to load services. Please try again.';\n        this.loading = false;\n\n        // Fallback to empty array\n        this.services = [];\n      }\n    },\n    async fetchServiceTypes() {\n      try {\n        this.loading = true;\n        console.log('Fetching service categories from database...');\n        const response = await serviceAPI.getServiceTypes();\n        if (response && Array.isArray(response) && response.length > 0) {\n          this.categories = response;\n          console.log(`Received ${this.categories.length} service categories`);\n        } else {\n          console.warn('No service categories returned from API, using defaults');\n          // Fallback to defaults if API returns empty array\n          this.categories = ['AC Repair', 'Plumbing', 'Electrical', 'Carpentry', 'Painting', 'Cleaning', 'Pest Control', 'Appliance Repair', 'Moving Services', 'Gardening'];\n        }\n        this.loading = false;\n      } catch (error) {\n        console.error('Error fetching service categories:', error);\n        // Fallback to defaults on error\n        this.categories = ['AC Repair', 'Plumbing', 'Electrical', 'Carpentry', 'Painting', 'Cleaning', 'Pest Control', 'Appliance Repair', 'Moving Services', 'Gardening'];\n        this.loading = false;\n      }\n    },\n    async fetchRequests() {\n      try {\n        this.loading = true;\n        console.log('Fetching customer requests...');\n        const response = await customerAPI.getRequests();\n        if (!response || !Array.isArray(response)) {\n          console.warn('Invalid response format for customer requests:', response);\n          this.serviceRequests = [];\n        } else {\n          console.log(`Retrieved ${response.length} requests for customer`);\n          this.serviceRequests = response;\n        }\n      } catch (error) {\n        console.error('Error fetching requests:', error);\n        this.error = 'Failed to load service requests. Please try again.';\n        this.serviceRequests = []; // Fallback to empty array\n      } finally {\n        this.loading = false;\n      }\n    },\n    async refreshServices() {\n      try {\n        this.loading = true;\n        this.error = null;\n        await this.fetchServices();\n        // Reset some search parameters but keep category if selected\n        const category = this.searchQuery.category;\n        this.searchQuery = {\n          name: '',\n          category,\n          pinCode: ''\n        };\n      } catch (error) {\n        console.error('Error refreshing services:', error);\n        this.error = 'Failed to refresh services. Please try again.';\n      } finally {\n        this.loading = false;\n      }\n    },\n    toggleAdvancedSearch() {\n      this.showAdvancedSearch = !this.showAdvancedSearch;\n    },\n    quickFilterByCategory(category) {\n      if (this.searchQuery.category === category) {\n        // If clicking the already selected category, clear it\n        this.searchQuery.category = '';\n      } else {\n        this.searchQuery.category = category;\n      }\n      this.handleSearch(this.searchQuery);\n    },\n    clearCategoryFilter() {\n      this.searchQuery.category = '';\n      this.handleSearch(this.searchQuery);\n    },\n    async loadMoreServices() {\n      if (this.loading || !this.hasMoreServices) return;\n      try {\n        this.loading = true;\n        this.page += 1;\n\n        // Call API with pagination parameters\n        const moreServices = await serviceAPI.getServices({\n          page: this.page,\n          ...this.searchQuery\n        });\n        if (moreServices && moreServices.length) {\n          this.services = [...this.services, ...moreServices];\n          // Check if we've reached the end\n          this.hasMoreServices = moreServices.length >= 10; // Assuming 10 per page\n        } else {\n          this.hasMoreServices = false;\n        }\n      } catch (error) {\n        console.error('Error loading more services:', error);\n        this.error = 'Failed to load more services.';\n      } finally {\n        this.loading = false;\n      }\n    },\n    async createRequest() {\n      this.isLoading = true;\n      try {\n        // Validate that we have either service_id or category\n        if (!this.newRequest.service_id && !this.newRequest.category) {\n          throw new Error(\"Please select a service category\");\n        }\n\n        // Ensure pin_code is valid\n        if (!this.newRequest.pin_code || !/^\\d{6}$/.test(this.newRequest.pin_code)) {\n          throw new Error(\"Please enter a valid 6-digit PIN code\");\n        }\n        console.log('Submitting request with data:', this.newRequest);\n        try {\n          const response = await customerAPI.createRequest(this.newRequest);\n          this.showNewRequestModal = false;\n          this.newRequest = {\n            service_id: '',\n            pin_code: '',\n            special_instructions: '',\n            category: ''\n          };\n          this.activeSection = 'requests'; // Switch to requests tab\n          await this.fetchRequests();\n          alert('Service request created successfully!');\n        } catch (apiError) {\n          // Show more friendly error message with details from the backend\n          if (apiError.message.includes('No service found in category')) {\n            throw new Error(`We currently don't have service professionals for ${this.newRequest.category}. Please try a different category.`);\n          } else {\n            throw apiError;\n          }\n        }\n      } catch (error) {\n        console.error('Error creating request:', error);\n        alert('Failed to create service request: ' + (error.message || 'Unknown error'));\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    async closeRequest(request, fromModal = false) {\n      if (confirm('Are you sure you want to cancel this request?')) {\n        try {\n          this.isLoading = true;\n          await customerAPI.closeRequest(request.id);\n          await this.fetchRequests();\n          if (fromModal) {\n            this.showRequestDetailsModal = false;\n          }\n          alert('Request cancelled successfully.');\n        } catch (error) {\n          console.error('Error closing request:', error);\n          alert('Failed to cancel request: ' + (error.message || 'Unknown error'));\n        } finally {\n          this.isLoading = false;\n        }\n      }\n    },\n    editRequest(request) {\n      // Implement edit functionality (e.g., populate form with current values)\n      this.newRequest = {\n        service_id: request.service_id,\n        pin_code: request.pin_code,\n        special_instructions: request.special_instructions || '',\n        category: request.category || ''\n      };\n      this.showNewRequestModal = true;\n    },\n    addReview(request) {\n      this.selectedRequest = request;\n      this.review = {\n        rating: 0,\n        remarks: ''\n      };\n      this.showReviewModal = true;\n    },\n    async submitReview() {\n      try {\n        this.isLoading = true;\n        await customerAPI.addReview(this.selectedRequest.id, this.review);\n        this.showReviewModal = false;\n        this.review = {\n          rating: 0,\n          remarks: ''\n        };\n        await this.fetchRequests();\n        alert('Review submitted successfully.');\n      } catch (error) {\n        console.error('Error submitting review:', error);\n        alert('Failed to submit review: ' + (error.message || 'Unknown error'));\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    selectService(service) {\n      this.selectedService = service;\n      this.showServiceModal = true;\n    },\n    requestSelectedService() {\n      this.newRequest.service_id = this.selectedService.id;\n      this.showServiceModal = false;\n      this.showNewRequestModal = true;\n    },\n    viewRequestDetails(request) {\n      this.selectedRequest = request;\n      this.showRequestDetailsModal = true;\n    },\n    formatDate(dateString, short = false) {\n      if (!dateString) return 'N/A';\n      const date = new Date(dateString);\n      if (short) {\n        return date.toLocaleDateString('en-US', {\n          month: 'short',\n          day: 'numeric'\n        });\n      }\n      return date.toLocaleString('en-US', {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    },\n    getStatusBadgeClass(status) {\n      const classes = {\n        pending: 'badge bg-warning',\n        assigned: 'badge bg-info',\n        in_progress: 'badge bg-primary',\n        completed: 'badge bg-success',\n        closed: 'badge bg-secondary',\n        cancelled: 'badge bg-danger'\n      };\n      return classes[status] || 'badge bg-secondary';\n    },\n    handleSearch(params) {\n      this.searchQuery = {\n        ...params\n      };\n      this.page = 1;\n      this.fetchServices();\n    },\n    directRequestService(service) {\n      this.selectedService = service;\n      this.showNewRequestModal = true;\n      // Pre-populate the request form with the selected service\n      this.newRequest.service_id = service.id;\n    },\n    handleReviewSubmitted() {\n      this.showReviewModal = false;\n      alert('Thank you for your review!');\n      this.fetchRequests();\n    },\n    getActiveCount() {\n      return this.serviceRequests.filter(request => ['pending', 'assigned', 'in_progress'].includes(request.status)).length;\n    },\n    getCompletedCount() {\n      return this.serviceRequests.filter(request => ['completed', 'closed'].includes(request.status)).length;\n    }\n  },\n  async created() {\n    try {\n      console.log('CustomerDashboard created, loading data...');\n      await Promise.all([this.fetchServices(), this.fetchServiceTypes(), this.fetchRequests()]);\n    } catch (error) {\n      console.error('Error initializing dashboard:', error);\n      this.error = 'Failed to load dashboard data. Please refresh the page.';\n    }\n  }\n};","map":{"version":3,"names":["serviceAPI","customerAPI","ServiceSearchPanel","ServiceList","ServiceReviewForm","name","components","data","user","JSON","parse","localStorage","getItem","userName","username","activeSection","activeTab","showServiceModal","showNewRequestModal","showReviewModal","showRequestDetailsModal","selectedService","selectedRequest","searchQuery","category","pinCode","services","categories","serviceRequests","loading","error","newRequest","service_id","pin_code","special_instructions","isLoading","page","hasMoreServices","showAdvancedSearch","computed","filteredRequests","filter","request","includes","status","filteredServices","length","service","toLowerCase","available_pin_codes","methods","fetchServices","console","log","response","getServices","fetchServiceTypes","getServiceTypes","Array","isArray","warn","fetchRequests","getRequests","refreshServices","toggleAdvancedSearch","quickFilterByCategory","handleSearch","clearCategoryFilter","loadMoreServices","moreServices","createRequest","Error","test","alert","apiError","message","closeRequest","fromModal","confirm","id","editRequest","addReview","review","rating","remarks","submitReview","selectService","requestSelectedService","viewRequestDetails","formatDate","dateString","short","date","Date","toLocaleDateString","month","day","toLocaleString","year","hour","minute","getStatusBadgeClass","classes","pending","assigned","in_progress","completed","closed","cancelled","params","directRequestService","handleReviewSubmitted","getActiveCount","getCompletedCount","created","Promise","all"],"sources":["src/views/CustomerDashboard.vue"],"sourcesContent":["<template>\r\n  <div class=\"customer-dashboard\">\r\n    <div class=\"container py-4\">\r\n      <!-- Welcome Section -->\r\n      <div class=\"row mb-4\">\r\n        <div class=\"col-md-8\">\r\n          <h2>Welcome, {{ userName }}!</h2>\r\n          <p class=\"text-muted\">Find services and manage your requests</p>\r\n        </div>\r\n        <div class=\"col-md-4 text-md-end\">\r\n          <button class=\"btn btn-primary\" @click=\"showNewRequestModal = true\">\r\n            <i class=\"fas fa-plus me-2\"></i>New Service Request\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Main Navigation Tabs -->\r\n      <ul class=\"nav nav-pills mb-4\">\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" :class=\"{ active: activeSection === 'browse' }\" \r\n             @click.prevent=\"activeSection = 'browse'\" href=\"#\">\r\n            <i class=\"fas fa-search me-1\"></i> Browse Services\r\n          </a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" :class=\"{ active: activeSection === 'requests' }\" \r\n             @click.prevent=\"activeSection = 'requests'\" href=\"#\">\r\n            <i class=\"fas fa-list-alt me-1\"></i> My Requests\r\n          </a>\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- Browse Services Section -->\r\n      <div v-if=\"activeSection === 'browse'\">\r\n        <div class=\"browse-services-container\">\r\n          <!-- Header with Stats -->\r\n          <div class=\"services-header mb-4\">\r\n            <div class=\"row align-items-center\">\r\n              <div class=\"col-md-6\">\r\n                <h4>Browse Available Services</h4>\r\n                <p class=\"text-muted mb-md-0\">\r\n                  <span v-if=\"!loading\">{{ filteredServices.length }} services available</span>\r\n                  <span v-else>Finding the best services for you...</span>\r\n                </p>\r\n              </div>\r\n              <div class=\"col-md-6 text-md-end\">\r\n                <div class=\"btn-group\">\r\n                  <button class=\"btn btn-outline-primary\" @click=\"refreshServices\">\r\n                    <i class=\"fas fa-sync-alt me-1\"></i> Refresh\r\n                  </button>\r\n                  <button class=\"btn btn-outline-secondary\" @click=\"toggleAdvancedSearch\">\r\n                    <i class=\"fas fa-sliders-h me-1\"></i> Filters\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Enhanced Service Search Panel -->\r\n          <ServiceSearchPanel \r\n            :initialParams=\"searchQuery\" \r\n            :categories=\"categories\"\r\n            @search=\"handleSearch\"\r\n            :class=\"{ 'mb-4': true, 'collapsed': !showAdvancedSearch }\"\r\n          />\r\n\r\n          <!-- Popular Categories Quick Filter -->\r\n          <div class=\"category-chips mb-4\">\r\n            <button \r\n              v-for=\"category in popularCategories\" \r\n              :key=\"category\" \r\n              class=\"category-chip\" \r\n              :class=\"{ active: searchQuery.category === category }\"\r\n              @click=\"quickFilterByCategory(category)\"\r\n            >\r\n              <span>{{ category }}</span>\r\n            </button>\r\n            <button class=\"category-chip\" @click=\"clearCategoryFilter\">\r\n              <i class=\"fas fa-times me-1\"></i> Clear\r\n            </button>\r\n          </div>\r\n\r\n          <!-- Error Alert -->\r\n          <div v-if=\"error\" class=\"alert alert-danger mb-4\" role=\"alert\">\r\n            <i class=\"fas fa-exclamation-triangle me-2\"></i>\r\n            {{ error }}\r\n            <button type=\"button\" class=\"btn-close float-end\" @click=\"error = null\"></button>\r\n          </div>\r\n\r\n          <!-- Service List Component -->\r\n          <ServiceList\r\n            :services=\"filteredServices\"\r\n            :loading=\"loading\"\r\n            :hasMore=\"hasMoreServices\"\r\n            @view-details=\"selectService\"\r\n            @request-service=\"directRequestService\"\r\n            @load-more=\"loadMoreServices\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <!-- My Requests Section -->\r\n      <div v-if=\"activeSection === 'requests'\">\r\n        <!-- Service Requests Tabs -->\r\n        <ul class=\"nav nav-tabs mb-4\">\r\n          <li class=\"nav-item\">\r\n            <a \r\n              class=\"nav-link\" \r\n              :class=\"{ active: activeTab === 'active' }\"\r\n              @click.prevent=\"activeTab = 'active'\"\r\n              href=\"#\"\r\n            >\r\n              <i class=\"fas fa-spinner me-1\"></i> Active Requests\r\n              <span v-if=\"getActiveCount() > 0\" class=\"badge rounded-pill bg-primary ms-1\">\r\n                {{ getActiveCount() }}\r\n              </span>\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a \r\n              class=\"nav-link\" \r\n              :class=\"{ active: activeTab === 'completed' }\"\r\n              @click.prevent=\"activeTab = 'completed'\"\r\n              href=\"#\"\r\n            >\r\n              <i class=\"fas fa-check-circle me-1\"></i> Service History\r\n              <span v-if=\"getCompletedCount() > 0\" class=\"badge rounded-pill bg-success ms-1\">\r\n                {{ getCompletedCount() }}\r\n              </span>\r\n            </a>\r\n          </li>\r\n        </ul>\r\n\r\n        <!-- Service Requests List -->\r\n        <div v-if=\"loading\" class=\"text-center py-5\">\r\n          <div class=\"spinner-border text-primary\" role=\"status\">\r\n            <span class=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n          <p class=\"mt-2\">Loading your requests...</p>\r\n        </div>\r\n        \r\n        <div v-else-if=\"filteredRequests.length === 0\" class=\"text-center py-5\">\r\n          <i class=\"fas fa-inbox fa-3x text-muted mb-3\"></i>\r\n          <h5>No service requests found</h5>\r\n          <p class=\"text-muted\">\r\n            {{ activeTab === 'active' ? 'Create a new request to get started!' : 'No completed requests yet.' }}\r\n          </p>\r\n          <button v-if=\"activeTab === 'active'\" class=\"btn btn-primary mt-2\" @click=\"showNewRequestModal = true\">\r\n            <i class=\"fas fa-plus me-2\"></i>Create Service Request\r\n          </button>\r\n        </div>\r\n        \r\n        <div v-else class=\"row g-4\">\r\n          <div v-for=\"request in filteredRequests\" :key=\"request.id\" class=\"col-md-6\">\r\n            <div class=\"card h-100 shadow-sm\" :class=\"{'border-warning': request.status === 'pending', \r\n                                                     'border-primary': request.status === 'in_progress',\r\n                                                     'border-success': request.status === 'completed'}\">\r\n              <div class=\"card-header bg-transparent d-flex justify-content-between align-items-center\">\r\n                <span :class=\"getStatusBadgeClass(request.status)\">\r\n                  {{ request.status }}\r\n                </span>\r\n                <small class=\"text-muted\">\r\n                  <i class=\"fas fa-calendar me-1\"></i> {{ formatDate(request.created_at, true) }}\r\n                </small>\r\n              </div>\r\n              <div class=\"card-body\">\r\n                <h5 class=\"card-title mb-3\">{{ request.service.name }}</h5>\r\n                \r\n                <div class=\"d-flex mb-3\">\r\n                  <div class=\"me-3\">\r\n                    <i class=\"fas fa-map-marker-alt text-muted me-1\"></i> {{ request.pin_code }}\r\n                  </div>\r\n                  <div v-if=\"request.final_amount\">\r\n                    <i class=\"fas fa-money-bill-wave text-success me-1\"></i> ₹{{ request.final_amount }}\r\n                  </div>\r\n                </div>\r\n\r\n                <div v-if=\"request.professional\" class=\"mb-3 p-2 bg-light rounded\">\r\n                  <div class=\"d-flex align-items-center\">\r\n                    <i class=\"fas fa-user-tie text-primary me-2 fa-lg\"></i>\r\n                    <div>\r\n                      <strong>{{ request.professional.professional_name }}</strong>\r\n                      <p class=\"text-muted mb-0 small\">{{ request.professional.service_type }}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <p v-if=\"request.special_instructions\" class=\"card-text text-truncate mb-3\" \r\n                   :title=\"request.special_instructions\">\r\n                  {{ request.special_instructions }}\r\n                </p>\r\n\r\n                <!-- Status update indicators -->\r\n                <div class=\"mb-3 service-progress\">\r\n                  <div class=\"status-track d-flex justify-content-between\">\r\n                    <div class=\"status-point\" :class=\"{'active': true}\">\r\n                      <i class=\"fas fa-plus-circle\"></i>\r\n                      <span>Created</span>\r\n                    </div>\r\n                    <div class=\"status-point\" :class=\"{'active': ['in_progress', 'completed', 'closed'].includes(request.status)}\">\r\n                      <i class=\"fas fa-tools\"></i>\r\n                      <span>In Progress</span>\r\n                    </div>\r\n                    <div class=\"status-point\" :class=\"{'active': ['completed', 'closed'].includes(request.status)}\">\r\n                      <i class=\"fas fa-check-circle\"></i>\r\n                      <span>Completed</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Action Buttons -->\r\n                <div class=\"d-flex justify-content-end gap-2 mt-3\">\r\n                  <button\r\n                    v-if=\"request.status === 'pending' || request.status === 'assigned'\"\r\n                    class=\"btn btn-outline-danger btn-sm\"\r\n                    @click=\"closeRequest(request)\"\r\n                  >\r\n                    <i class=\"fas fa-times me-1\"></i>\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    v-if=\"request.status === 'pending'\"\r\n                    class=\"btn btn-outline-primary btn-sm\"\r\n                    @click=\"editRequest(request)\"\r\n                  >\r\n                    <i class=\"fas fa-edit me-1\"></i>\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    v-if=\"request.status === 'completed' && !request.has_review\"\r\n                    class=\"btn btn-outline-success btn-sm\"\r\n                    @click=\"addReview(request)\"\r\n                  >\r\n                    <i class=\"fas fa-star me-1\"></i>\r\n                    Review\r\n                  </button>\r\n                  <button\r\n                    class=\"btn btn-outline-secondary btn-sm\"\r\n                    @click=\"viewRequestDetails(request)\"\r\n                  >\r\n                    <i class=\"fas fa-eye me-1\"></i>\r\n                    Details\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Service Details Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showServiceModal }\" v-if=\"showServiceModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">Service Details</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showServiceModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\" v-if=\"selectedService\">\r\n            <div class=\"service-details\">\r\n              <h4>{{ selectedService.name }}</h4>\r\n              <div class=\"d-flex justify-content-between mb-3\">\r\n                <span class=\"badge bg-primary fs-5\">₹{{ selectedService.base_price }}</span>\r\n                <span class=\"text-muted\"><i class=\"far fa-clock me-2\"></i>{{ selectedService.time_required }} minutes</span>\r\n              </div>\r\n              <p>{{ selectedService.description }}</p>\r\n              <div class=\"mb-3\">\r\n                <strong>Category:</strong> {{ selectedService.category }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" @click=\"showServiceModal = false\">Close</button>\r\n            <button type=\"button\" class=\"btn btn-primary\" @click=\"requestSelectedService\">\r\n              <i class=\"fas fa-plus me-1\"></i> Request Service\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- New Service Request Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showNewRequestModal }\" v-if=\"showNewRequestModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">New Service Request</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showNewRequestModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <form @submit.prevent=\"createRequest\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"serviceCategory\" class=\"form-label\">Service Category</label>\r\n                <select id=\"serviceCategory\" name=\"serviceCategory\" class=\"form-select\" v-model=\"newRequest.category\">\r\n                  <option value=\"\">Select Category</option>\r\n                  <option v-for=\"category in categories\" :key=\"category\" :value=\"category\">\r\n                    {{ category }}\r\n                  </option>\r\n                </select>\r\n              </div>\r\n              <div class=\"mb-3\">\r\n                <label for=\"pinCode\" class=\"form-label\">PIN Code</label>\r\n                <input \r\n                  id=\"pinCode\"\r\n                  name=\"pinCode\"\r\n                  type=\"text\"\r\n                  class=\"form-control\"\r\n                  v-model=\"newRequest.pin_code\"\r\n                  required\r\n                  pattern=\"[0-9]{6}\"\r\n                  placeholder=\"Enter 6-digit PIN code\"\r\n                >\r\n              </div>\r\n              <div class=\"mb-3\">\r\n                <label for=\"specialInstructions\" class=\"form-label\">Special Instructions</label>\r\n                <textarea\r\n                  id=\"specialInstructions\"\r\n                  name=\"specialInstructions\"\r\n                  class=\"form-control\"\r\n                  v-model=\"newRequest.special_instructions\"\r\n                  rows=\"3\"\r\n                  placeholder=\"Any specific requirements or details...\"\r\n                ></textarea>\r\n              </div>\r\n              <div class=\"text-end\">\r\n                <button type=\"button\" class=\"btn btn-secondary me-2\" @click=\"showNewRequestModal = false\">\r\n                  Cancel\r\n                </button>\r\n                <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"isLoading\">\r\n                  <span v-if=\"isLoading\" class=\"spinner-border spinner-border-sm me-2\"></span>\r\n                  Create Request\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Enhanced Review Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showReviewModal }\" v-if=\"showReviewModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <ServiceReviewForm\r\n            :requestId=\"selectedRequest?.id\"\r\n            :serviceName=\"selectedRequest?.service?.name\"\r\n            :serviceDate=\"selectedRequest?.completed_at\"\r\n            :professionalName=\"selectedRequest?.professional?.professional_name\"\r\n            @close=\"showReviewModal = false\"\r\n            @submitted=\"handleReviewSubmitted\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Enhanced Request Details Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showRequestDetailsModal }\" v-if=\"showRequestDetailsModal\">\r\n      <div class=\"modal-dialog modal-lg\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">Request Details</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showRequestDetailsModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\" v-if=\"selectedRequest\">\r\n            <div class=\"row mb-4\">\r\n              <div class=\"col-md-6\">\r\n                <h5>{{ selectedRequest.service?.name }}</h5>\r\n                <div :class=\"getStatusBadgeClass(selectedRequest.status)\" class=\"mb-2 badge-lg\">\r\n                  {{ selectedRequest.status }}\r\n                </div>\r\n                <p class=\"text-muted\">\r\n                  <i class=\"fas fa-map-marker-alt me-2\"></i>\r\n                  PIN Code: {{ selectedRequest.pin_code }}\r\n                </p>\r\n                <p v-if=\"selectedRequest.final_amount\" class=\"badge bg-success\">\r\n                  Final Amount: ₹{{ selectedRequest.final_amount }}\r\n                </p>\r\n              </div>\r\n              <div class=\"col-md-6 text-md-end\">\r\n                <p class=\"mb-1\"><strong>Requested:</strong> {{ formatDate(selectedRequest.created_at) }}</p>\r\n                <p v-if=\"selectedRequest.accepted_at\" class=\"mb-1\">\r\n                  <strong>Accepted:</strong> {{ formatDate(selectedRequest.accepted_at) }}\r\n                </p>\r\n                <p v-if=\"selectedRequest.completed_at\" class=\"mb-1\">\r\n                  <strong>Completed:</strong> {{ formatDate(selectedRequest.completed_at) }}\r\n                </p>\r\n                <p v-if=\"selectedRequest.closed_at\" class=\"mb-1\">\r\n                  <strong>Closed:</strong> {{ formatDate(selectedRequest.closed_at) }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n            <!-- Service Request Timeline -->\r\n            <div class=\"service-timeline mb-4\">\r\n              <h6>Service Timeline</h6>\r\n              <div class=\"timeline\">\r\n                <div class=\"timeline-item\">\r\n                  <div class=\"timeline-marker bg-success\"></div>\r\n                  <div class=\"timeline-content\">\r\n                    <p class=\"mb-0\"><strong>Request Created</strong></p>\r\n                    <p class=\"text-muted small mb-0\">{{ formatDate(selectedRequest.created_at) }}</p>\r\n                  </div>\r\n                </div>\r\n                <div v-if=\"selectedRequest.accepted_at\" class=\"timeline-item\">\r\n                  <div class=\"timeline-marker bg-primary\"></div>\r\n                  <div class=\"timeline-content\">\r\n                    <p class=\"mb-0\"><strong>Professional Assigned</strong></p>\r\n                    <p class=\"text-muted small mb-0\">{{ formatDate(selectedRequest.accepted_at) }}</p>\r\n                    <p v-if=\"selectedRequest.professional\" class=\"small mb-0\">\r\n                      {{ selectedRequest.professional.professional_name }} was assigned to your request\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div v-if=\"selectedRequest.completed_at\" class=\"timeline-item\">\r\n                  <div class=\"timeline-marker bg-info\"></div>\r\n                  <div class=\"timeline-content\">\r\n                    <p class=\"mb-0\"><strong>Service Completed</strong></p>\r\n                    <p class=\"text-muted small mb-0\">{{ formatDate(selectedRequest.completed_at) }}</p>\r\n                    <p v-if=\"selectedRequest.final_amount\" class=\"small mb-0\">\r\n                      Service completed with final amount: ₹{{ selectedRequest.final_amount }}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div v-if=\"selectedRequest.closed_at\" class=\"timeline-item\">\r\n                  <div class=\"timeline-marker bg-secondary\"></div>\r\n                  <div class=\"timeline-content\">\r\n                    <p class=\"mb-0\"><strong>Request Closed</strong></p>\r\n                    <p class=\"text-muted small mb-0\">{{ formatDate(selectedRequest.closed_at) }}</p>\r\n                  </div>\r\n                </div>\r\n                <div v-if=\"selectedRequest.has_review\" class=\"timeline-item\">\r\n                  <div class=\"timeline-marker bg-warning\"></div>\r\n                  <div class=\"timeline-content\">\r\n                    <p class=\"mb-0\"><strong>Review Submitted</strong></p>\r\n                    <div v-if=\"selectedRequest.review\" class=\"mt-1\">\r\n                      <div class=\"star-rating small\">\r\n                        <i v-for=\"n in 5\" :key=\"n\" \r\n                          class=\"fas fa-star\" \r\n                          :class=\"n <= selectedRequest.review.rating ? 'text-warning' : 'text-muted'\"></i>\r\n                      </div>\r\n                      <p class=\"small mt-1 mb-0\">{{ selectedRequest.review.remarks }}</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <!-- Special Instructions -->\r\n            <div class=\"mb-4\">\r\n              <h6>Special Instructions</h6>\r\n              <p class=\"p-3 bg-light rounded\">{{ selectedRequest.special_instructions || 'No special instructions provided.' }}</p>\r\n            </div>\r\n            <!-- Professional Details -->\r\n            <div v-if=\"selectedRequest.professional\" class=\"mb-4\">\r\n              <h6>Professional Details</h6>\r\n              <div class=\"card\">\r\n                <div class=\"card-body\">\r\n                  <h5 class=\"card-title\">{{ selectedRequest.professional.professional_name }}</h5>\r\n                  <p class=\"text-muted mb-1\">\r\n                    <strong>Service Type:</strong> {{ selectedRequest.professional.service_type }}\r\n                  </p>\r\n                  <p class=\"text-muted mb-0\">\r\n                    <strong>Experience:</strong> {{ selectedRequest.professional.experience }} years\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <!-- Action Buttons -->\r\n            <div class=\"d-flex justify-content-end gap-2 mt-4\">\r\n              <button \r\n                v-if=\"selectedRequest.status === 'pending' || selectedRequest.status === 'assigned'\"\r\n                class=\"btn btn-danger\" \r\n                @click=\"closeRequest(selectedRequest, true)\">\r\n                <i class=\"fas fa-times me-1\"></i> Cancel Request\r\n              </button>\r\n              <button \r\n                v-if=\"selectedRequest.status === 'completed' && !selectedRequest.has_review\"\r\n                class=\"btn btn-warning\" \r\n                @click=\"addReview(selectedRequest)\">\r\n                <i class=\"fas fa-star me-1\"></i> Review Service\r\n              </button>\r\n              <button \r\n                class=\"btn btn-secondary\" \r\n                @click=\"showRequestDetailsModal = false\">\r\n                Close\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { serviceAPI, customerAPI } from '@/services/api';\r\nimport ServiceSearchPanel from '@/components/ServiceSearchPanel.vue';\r\nimport ServiceList from '@/components/ServiceList.vue';\r\nimport ServiceReviewForm from '@/components/ServiceReviewForm.vue';\r\n\r\nexport default {\r\n  name: 'CustomerDashboard',\r\n  components: {\r\n    ServiceSearchPanel,\r\n    ServiceList,\r\n    ServiceReviewForm\r\n  },\r\n\r\n  data() {\r\n    const user = JSON.parse(localStorage.getItem('user')) || {};\r\n    return {\r\n      userName: user.name || user.username || 'Customer',\r\n      activeSection: 'browse',\r\n      activeTab: 'active',\r\n      showServiceModal: false,\r\n      showNewRequestModal: false,\r\n      showReviewModal: false,\r\n      showRequestDetailsModal: false,\r\n      selectedService: null,\r\n      selectedRequest: null,\r\n      searchQuery: {\r\n        name: '',\r\n        category: '',\r\n        pinCode: ''\r\n      },\r\n      services: [],\r\n      categories: [\r\n        'AC Repair',\r\n        'Plumbing',\r\n        'Electrical',\r\n        'Carpentry',\r\n        'Painting',\r\n        'Cleaning',\r\n        'Pest Control',\r\n        'Appliance Repair',\r\n        'Moving Services',\r\n        'Gardening'\r\n      ],\r\n      serviceRequests: [],\r\n      loading: false,\r\n      error: null,\r\n      newRequest: {\r\n        service_id: '',\r\n        pin_code: '',\r\n        special_instructions: '',\r\n        category: ''\r\n      },\r\n      isLoading: false,\r\n      page: 1,\r\n      hasMoreServices: true,\r\n      showAdvancedSearch: false\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    filteredRequests() {\r\n      return this.serviceRequests.filter(request => {\r\n        if (this.activeTab === 'active') {\r\n          return ['pending', 'assigned', 'in_progress'].includes(request.status)\r\n        } else {\r\n          return ['completed', 'closed'].includes(request.status)\r\n        }\r\n      })\r\n    },\r\n    filteredServices() {\r\n      if (!this.services.length) return [];\r\n      return this.services.filter(service => {\r\n        // Filter by name\r\n        if (this.searchQuery.name && !service.name.toLowerCase().includes(this.searchQuery.name.toLowerCase())) {\r\n          return false;\r\n        }\r\n        \r\n        // Filter by category\r\n        if (this.searchQuery.category && service.category !== this.searchQuery.category) {\r\n          return false;\r\n        }\r\n\r\n        // Filter by PIN code if implemented\r\n        if (this.searchQuery.pinCode && service.available_pin_codes) {\r\n          if (!service.available_pin_codes.includes(this.searchQuery.pinCode)) {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      });\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    async fetchServices() {\r\n      try {\r\n        this.loading = true;\r\n        console.log('CustomerDashboard: Fetching services...');\r\n        // Use adminAPI to fetch services, as we need full service list for browsing\r\n        const response = await serviceAPI.getServices();\r\n        console.log(`CustomerDashboard: Received ${response ? response.length : 0} services`);\r\n        this.services = response || [];\r\n        this.loading = false;\r\n      } catch (error) {\r\n        console.error('CustomerDashboard: Error fetching services:', error);\r\n        this.error = 'Failed to load services. Please try again.';\r\n        this.loading = false;\r\n        \r\n        // Fallback to empty array\r\n        this.services = [];\r\n      }\r\n    },\r\n\r\n    async fetchServiceTypes() {\r\n      try {\r\n        this.loading = true;\r\n        console.log('Fetching service categories from database...');\r\n        const response = await serviceAPI.getServiceTypes();\r\n        if (response && Array.isArray(response) && response.length > 0) {\r\n          this.categories = response;\r\n          console.log(`Received ${this.categories.length} service categories`);\r\n        } else {\r\n          console.warn('No service categories returned from API, using defaults');\r\n          // Fallback to defaults if API returns empty array\r\n          this.categories = [\r\n            'AC Repair', 'Plumbing', 'Electrical', 'Carpentry', 'Painting',\r\n            'Cleaning', 'Pest Control', 'Appliance Repair', 'Moving Services', 'Gardening'\r\n          ];\r\n        }\r\n        this.loading = false;\r\n      } catch (error) {\r\n        console.error('Error fetching service categories:', error);\r\n        // Fallback to defaults on error\r\n        this.categories = [\r\n          'AC Repair', 'Plumbing', 'Electrical', 'Carpentry', 'Painting',\r\n          'Cleaning', 'Pest Control', 'Appliance Repair', 'Moving Services', 'Gardening'\r\n        ];\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    async fetchRequests() {\r\n      try {\r\n        this.loading = true;\r\n        console.log('Fetching customer requests...');\r\n        const response = await customerAPI.getRequests();\r\n        if (!response || !Array.isArray(response)) {\r\n          console.warn('Invalid response format for customer requests:', response);\r\n          this.serviceRequests = [];\r\n        } else {\r\n          console.log(`Retrieved ${response.length} requests for customer`);\r\n          this.serviceRequests = response;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching requests:', error);\r\n        this.error = 'Failed to load service requests. Please try again.';\r\n        this.serviceRequests = []; // Fallback to empty array\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    async refreshServices() {\r\n      try {\r\n        this.loading = true;\r\n        this.error = null;\r\n        await this.fetchServices();\r\n        // Reset some search parameters but keep category if selected\r\n        const category = this.searchQuery.category;\r\n        this.searchQuery = { name: '', category, pinCode: '' };\r\n      } catch (error) {\r\n        console.error('Error refreshing services:', error);\r\n        this.error = 'Failed to refresh services. Please try again.';\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    toggleAdvancedSearch() {\r\n      this.showAdvancedSearch = !this.showAdvancedSearch;\r\n    },\r\n\r\n    quickFilterByCategory(category) {\r\n      if (this.searchQuery.category === category) {\r\n        // If clicking the already selected category, clear it\r\n        this.searchQuery.category = '';\r\n      } else {\r\n        this.searchQuery.category = category;\r\n      }\r\n      this.handleSearch(this.searchQuery);\r\n    },\r\n\r\n    clearCategoryFilter() {\r\n      this.searchQuery.category = '';\r\n      this.handleSearch(this.searchQuery);\r\n    },\r\n\r\n    async loadMoreServices() {\r\n      if (this.loading || !this.hasMoreServices) return;\r\n      \r\n      try {\r\n        this.loading = true;\r\n        this.page += 1;\r\n        \r\n        // Call API with pagination parameters\r\n        const moreServices = await serviceAPI.getServices({\r\n          page: this.page,\r\n          ...this.searchQuery\r\n        });\r\n        if (moreServices && moreServices.length) {\r\n          this.services = [...this.services, ...moreServices];\r\n          // Check if we've reached the end\r\n          this.hasMoreServices = moreServices.length >= 10; // Assuming 10 per page\r\n        } else {\r\n          this.hasMoreServices = false;\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading more services:', error);\r\n        this.error = 'Failed to load more services.';\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    async createRequest() {\r\n      this.isLoading = true;\r\n      try {\r\n        // Validate that we have either service_id or category\r\n        if (!this.newRequest.service_id && !this.newRequest.category) {\r\n          throw new Error(\"Please select a service category\");\r\n        }\r\n        \r\n        // Ensure pin_code is valid\r\n        if (!this.newRequest.pin_code || !/^\\d{6}$/.test(this.newRequest.pin_code)) {\r\n          throw new Error(\"Please enter a valid 6-digit PIN code\");\r\n        }\r\n        \r\n        console.log('Submitting request with data:', this.newRequest);\r\n        \r\n        try {\r\n          const response = await customerAPI.createRequest(this.newRequest);\r\n          this.showNewRequestModal = false;\r\n          this.newRequest = { service_id: '', pin_code: '', special_instructions: '', category: '' };\r\n          this.activeSection = 'requests'; // Switch to requests tab\r\n          await this.fetchRequests();\r\n          alert('Service request created successfully!');\r\n        } catch (apiError) {\r\n          // Show more friendly error message with details from the backend\r\n          if (apiError.message.includes('No service found in category')) {\r\n            throw new Error(`We currently don't have service professionals for ${this.newRequest.category}. Please try a different category.`);\r\n          } else {\r\n            throw apiError;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error creating request:', error);\r\n        alert('Failed to create service request: ' + (error.message || 'Unknown error'));\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    async closeRequest(request, fromModal = false) {\r\n      if (confirm('Are you sure you want to cancel this request?')) {\r\n        try {\r\n          this.isLoading = true;\r\n          await customerAPI.closeRequest(request.id);\r\n          await this.fetchRequests();\r\n          if (fromModal) {\r\n            this.showRequestDetailsModal = false;\r\n          }\r\n          alert('Request cancelled successfully.');\r\n        } catch (error) {\r\n          console.error('Error closing request:', error);\r\n          alert('Failed to cancel request: ' + (error.message || 'Unknown error'));\r\n        } finally {\r\n          this.isLoading = false;\r\n        }\r\n      }\r\n    },\r\n\r\n    editRequest(request) {\r\n      // Implement edit functionality (e.g., populate form with current values)\r\n      this.newRequest = {\r\n        service_id: request.service_id,\r\n        pin_code: request.pin_code,\r\n        special_instructions: request.special_instructions || '',\r\n        category: request.category || ''\r\n      };\r\n      this.showNewRequestModal = true;\r\n    },\r\n\r\n    addReview(request) {\r\n      this.selectedRequest = request;\r\n      this.review = { rating: 0, remarks: '' };\r\n      this.showReviewModal = true;\r\n    },\r\n\r\n    async submitReview() {\r\n      try {\r\n        this.isLoading = true;\r\n        await customerAPI.addReview(this.selectedRequest.id, this.review);\r\n        this.showReviewModal = false;\r\n        this.review = { rating: 0, remarks: '' };\r\n        await this.fetchRequests();\r\n        alert('Review submitted successfully.');\r\n      } catch (error) {\r\n        console.error('Error submitting review:', error);\r\n        alert('Failed to submit review: ' + (error.message || 'Unknown error'));\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    selectService(service) {\r\n      this.selectedService = service;\r\n      this.showServiceModal = true;\r\n    },\r\n\r\n    requestSelectedService() {\r\n      this.newRequest.service_id = this.selectedService.id;\r\n      this.showServiceModal = false;\r\n      this.showNewRequestModal = true;\r\n    },\r\n\r\n    viewRequestDetails(request) {\r\n      this.selectedRequest = request;\r\n      this.showRequestDetailsModal = true;\r\n    },\r\n\r\n    formatDate(dateString, short = false) {\r\n      if (!dateString) return 'N/A';\r\n      const date = new Date(dateString);\r\n      if (short) {\r\n        return date.toLocaleDateString('en-US', {\r\n          month: 'short',\r\n          day: 'numeric'\r\n        });\r\n      }\r\n      return date.toLocaleString('en-US', {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    },\r\n\r\n    getStatusBadgeClass(status) {\r\n      const classes = {\r\n        pending: 'badge bg-warning',\r\n        assigned: 'badge bg-info',\r\n        in_progress: 'badge bg-primary',\r\n        completed: 'badge bg-success',\r\n        closed: 'badge bg-secondary',\r\n        cancelled: 'badge bg-danger'\r\n      };\r\n      return classes[status] || 'badge bg-secondary';\r\n    },\r\n\r\n    handleSearch(params) {\r\n      this.searchQuery = { ...params };\r\n      this.page = 1;\r\n      this.fetchServices();\r\n    },\r\n\r\n    directRequestService(service) {\r\n      this.selectedService = service;\r\n      this.showNewRequestModal = true;\r\n      // Pre-populate the request form with the selected service\r\n      this.newRequest.service_id = service.id;\r\n    },\r\n\r\n    handleReviewSubmitted() {\r\n      this.showReviewModal = false;\r\n      alert('Thank you for your review!');\r\n      this.fetchRequests();\r\n    },\r\n\r\n    getActiveCount() {\r\n      return this.serviceRequests.filter(request => \r\n        ['pending', 'assigned', 'in_progress'].includes(request.status)\r\n      ).length;\r\n    },\r\n\r\n    getCompletedCount() {\r\n      return this.serviceRequests.filter(request => \r\n        ['completed', 'closed'].includes(request.status)\r\n      ).length;\r\n    }\r\n  },\r\n\r\n  async created() {\r\n    try {\r\n      console.log('CustomerDashboard created, loading data...');\r\n      await Promise.all([\r\n        this.fetchServices(),\r\n        this.fetchServiceTypes(),\r\n        this.fetchRequests()\r\n      ]);\r\n    } catch (error) {\r\n      console.error('Error initializing dashboard:', error);\r\n      this.error = 'Failed to load dashboard data. Please refresh the page.';\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.customer-dashboard {\r\n  background-color: #f8f9fa;\r\n  min-height: 100vh;\r\n}\r\n\r\n.service-card {\r\n  transition: transform 0.2s, box-shadow 0.2s;\r\n}\r\n\r\n.service-card:hover {\r\n  transform: translateY(-5px);\r\n  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.nav-pills .nav-link,\r\n.nav-tabs .nav-link {\r\n  font-size: 1rem;\r\n  cursor: pointer;\r\n}\r\n\r\n.modal.show {\r\n  display: block;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n.star-rating {\r\n  display: flex;\r\n  gap: 5px;\r\n}\r\n\r\n.star-rating i {\r\n  cursor: pointer;\r\n  color: #e0e0e0;\r\n}\r\n\r\n.star-rating i.active {\r\n  color: #ffc107;\r\n}\r\n\r\n/* Enhanced timeline and status styles */\r\n.badge-lg {\r\n  font-size: 1rem;\r\n  padding: 0.5rem 0.75rem;\r\n}\r\n\r\n.service-progress {\r\n  position: relative;\r\n  margin: 15px 0;\r\n}\r\n\r\n.status-track {\r\n  position: relative;\r\n  height: 40px;\r\n}\r\n\r\n.status-track:before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 10px;\r\n  left: 10px;\r\n  right: 10px;\r\n  height: 2px;\r\n  background-color: #e9ecef;\r\n  z-index: 1;\r\n}\r\n\r\n.status-point {\r\n  position: relative;\r\n  z-index: 2;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  color: #adb5bd;\r\n}\r\n\r\n.status-point i {\r\n  background-color: white;\r\n  border-radius: 50%;\r\n  padding: 5px;\r\n  font-size: 1rem;\r\n}\r\n\r\n.status-point span {\r\n  font-size: 0.65rem;\r\n  margin-top: 4px;\r\n}\r\n\r\n.status-point.active {\r\n  color: #0d6efd;\r\n}\r\n\r\n.status-point.active i {\r\n  color: #0d6efd;\r\n}\r\n\r\n.timeline {\r\n  position: relative;\r\n  padding-left: 40px;\r\n}\r\n\r\n.timeline-item {\r\n  position: relative;\r\n  padding-bottom: 25px;\r\n}\r\n\r\n.timeline-marker {\r\n  position: absolute;\r\n  left: -20px;\r\n  top: 0;\r\n  width: 16px;\r\n  height: 16px;\r\n  border-radius: 50%;\r\n}\r\n\r\n.timeline:before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: -12px;\r\n  width: 2px;\r\n  background-color: #e9ecef;\r\n}\r\n\r\n.timeline-content {\r\n  background-color: #f8f9fa;\r\n  padding: 10px 15px;\r\n  border-radius: 5px;\r\n}\r\n\r\n.card-header .badge {\r\n  font-size: 0.85rem;\r\n  padding: 0.35rem 0.65rem;\r\n}\r\n\r\n/* Browse Services Section Styles */\r\n.browse-services-container {\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.services-header {\r\n  background-color: #ffffff;\r\n  border-radius: 10px;\r\n  padding: 1.25rem;\r\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.category-chips {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 10px;\r\n}\r\n\r\n.category-chip {\r\n  background-color: #f8f9fa;\r\n  border: 1px solid #e9ecef;\r\n  color: #495057;\r\n  padding: 0.5rem 1rem;\r\n  border-radius: 50px;\r\n  font-size: 0.9rem;\r\n  transition: all 0.2s;\r\n  cursor: pointer;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  box-shadow: none;\r\n  outline: none;\r\n}\r\n\r\n.category-chip:hover {\r\n  background-color: #e9ecef;\r\n  color: #212529;\r\n}\r\n\r\n.category-chip.active {\r\n  background-color: #0d6efd;\r\n  color: white;\r\n  border-color: #0d6efd;\r\n}\r\n\r\n/* Animation for collapsing search panel */\r\n.collapsed {\r\n  max-height: 0;\r\n  overflow: hidden;\r\n  transition: max-height 0.3s ease-out;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { customerAPI, serviceAPI } from '@/services/api';\nexport default {\n  name: 'CustomerDashboard',\n  data() {\n    return {\n      userName: JSON.parse(localStorage.getItem('user'))?.name || 'Customer',\n      activeSection: 'browse',\n      // 'browse' or 'requests'\n      activeTab: 'active',\n      // For requests: 'active' or 'completed'\n      searchQuery: {\n        name: '',\n        pinCode: '',\n        category: ''\n      },\n      services: [],\n      categories: [],\n      serviceRequests: [],\n      showNewRequestModal: false,\n      showReviewModal: false,\n      showServiceModal: false,\n      showRequestDetailsModal: false,\n      isLoading: false,\n      loading: false,\n      // General loading state\n      newRequest: {\n        service_id: '',\n        pin_code: '',\n        special_instructions: ''\n      },\n      review: {\n        rating: 0,\n        remarks: ''\n      },\n      selectedRequest: null,\n      selectedService: null,\n      error: null\n    };\n  },\n  computed: {\n    filteredRequests() {\n      return this.serviceRequests.filter(request => {\n        if (this.activeTab === 'active') {\n          return ['pending', 'assigned', 'in_progress'].includes(request.status);\n        } else {\n          return ['completed', 'closed'].includes(request.status);\n        }\n      });\n    },\n    filteredServices() {\n      if (!this.services.length) return [];\n      return this.services.filter(service => {\n        // Filter by name\n        if (this.searchQuery.name && !service.name.toLowerCase().includes(this.searchQuery.name.toLowerCase())) {\n          return false;\n        }\n\n        // Filter by category\n        if (this.searchQuery.category && service.category !== this.searchQuery.category) {\n          return false;\n        }\n\n        // Filter by PIN code if implemented\n        if (this.searchQuery.pinCode && service.available_pin_codes) {\n          if (!service.available_pin_codes.includes(this.searchQuery.pinCode)) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n  },\n  methods: {\n    async fetchServices() {\n      try {\n        this.loading = true;\n        console.log('CustomerDashboard: Fetching services...');\n        const response = await serviceAPI.getServices();\n        console.log(`CustomerDashboard: Received ${response.length} services`);\n        this.services = response;\n        this.loading = false;\n      } catch (error) {\n        console.error('CustomerDashboard: Error fetching services:', error);\n        this.error = 'Failed to load services. Please try again.';\n        this.loading = false;\n\n        // Retry after a delay in case of network issues\n        setTimeout(() => {\n          if (this.services.length === 0) {\n            console.log('Retrying service fetch...');\n            this.fetchServices();\n          }\n        }, 3000);\n      }\n    },\n    async fetchServiceTypes() {\n      try {\n        console.log('CustomerDashboard: Fetching service types...');\n        const response = await serviceAPI.getServiceTypes();\n        console.log(`CustomerDashboard: Received ${response.length} service types`);\n        this.categories = response;\n      } catch (error) {\n        console.error('CustomerDashboard: Error fetching service types:', error);\n        this.error = 'Failed to load service categories. Please try again.';\n      }\n    },\n    async fetchRequests() {\n      try {\n        this.loading = true;\n        const response = await customerAPI.getRequests();\n        this.serviceRequests = response;\n        this.loading = false;\n      } catch (error) {\n        console.error('Error fetching requests:', error);\n        this.error = 'Failed to load service requests. Please try again.';\n        this.loading = false;\n      }\n    },\n    async searchServices() {\n      // You can implement additional search logic here if needed\n      // For now, we'll just use the computed filteredServices property\n    },\n    async createRequest() {\n      this.isLoading = true;\n      try {\n        await customerAPI.createRequest(this.newRequest);\n        this.showNewRequestModal = false;\n        this.newRequest = {\n          service_id: '',\n          pin_code: '',\n          special_instructions: ''\n        };\n        this.activeSection = 'requests'; // Switch to requests tab\n        await this.fetchRequests();\n        alert('Service request created successfully!');\n      } catch (error) {\n        console.error('Error creating request:', error);\n        alert('Failed to create service request: ' + (error.message || 'Unknown error'));\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    async closeRequest(request, fromModal = false) {\n      if (confirm('Are you sure you want to cancel this request?')) {\n        try {\n          this.isLoading = true;\n          await customerAPI.closeRequest(request.id);\n          await this.fetchRequests();\n          if (fromModal) {\n            this.showRequestDetailsModal = false;\n          }\n          alert('Request cancelled successfully.');\n        } catch (error) {\n          console.error('Error closing request:', error);\n          alert('Failed to cancel request: ' + (error.message || 'Unknown error'));\n        } finally {\n          this.isLoading = false;\n        }\n      }\n    },\n    editRequest(request) {\n      // Implement edit functionality (e.g., populate form with current values)\n      this.newRequest = {\n        service_id: request.service_id,\n        pin_code: request.pin_code,\n        special_instructions: request.special_instructions || ''\n      };\n      this.showNewRequestModal = true;\n    },\n    addReview(request) {\n      this.selectedRequest = request;\n      this.review = {\n        rating: 0,\n        remarks: ''\n      };\n      this.showReviewModal = true;\n      if (this.showRequestDetailsModal) {\n        this.showRequestDetailsModal = false;\n      }\n    },\n    async submitReview() {\n      try {\n        this.isLoading = true;\n        await customerAPI.addReview(this.selectedRequest.id, this.review);\n        this.showReviewModal = false;\n        this.review = {\n          rating: 0,\n          remarks: ''\n        };\n        await this.fetchRequests();\n        alert('Review submitted successfully.');\n      } catch (error) {\n        console.error('Error submitting review:', error);\n        alert('Failed to submit review: ' + (error.message || 'Unknown error'));\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    selectService(service) {\n      this.selectedService = service;\n      this.showServiceModal = true;\n    },\n    requestSelectedService() {\n      this.newRequest.service_id = this.selectedService.id;\n      this.showServiceModal = false;\n      this.showNewRequestModal = true;\n    },\n    viewRequestDetails(request) {\n      this.selectedRequest = request;\n      this.showRequestDetailsModal = true;\n    },\n    formatDate(dateString) {\n      if (!dateString) return 'N/A';\n      const date = new Date(dateString);\n      return date.toLocaleString('en-US', {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    },\n    getStatusBadgeClass(status) {\n      const classes = {\n        pending: 'badge bg-warning',\n        assigned: 'badge bg-info',\n        in_progress: 'badge bg-primary',\n        completed: 'badge bg-success',\n        closed: 'badge bg-secondary',\n        cancelled: 'badge bg-danger'\n      };\n      return classes[status] || 'badge bg-secondary';\n    }\n  },\n  async created() {\n    await Promise.all([this.fetchServices(), this.fetchServiceTypes(), this.fetchRequests()]);\n  }\n};","map":{"version":3,"names":["customerAPI","serviceAPI","name","data","userName","JSON","parse","localStorage","getItem","activeSection","activeTab","searchQuery","pinCode","category","services","categories","serviceRequests","showNewRequestModal","showReviewModal","showServiceModal","showRequestDetailsModal","isLoading","loading","newRequest","service_id","pin_code","special_instructions","review","rating","remarks","selectedRequest","selectedService","error","computed","filteredRequests","filter","request","includes","status","filteredServices","length","service","toLowerCase","available_pin_codes","methods","fetchServices","console","log","response","getServices","setTimeout","fetchServiceTypes","getServiceTypes","fetchRequests","getRequests","searchServices","createRequest","alert","message","closeRequest","fromModal","confirm","id","editRequest","addReview","submitReview","selectService","requestSelectedService","viewRequestDetails","formatDate","dateString","date","Date","toLocaleString","year","month","day","hour","minute","getStatusBadgeClass","classes","pending","assigned","in_progress","completed","closed","cancelled","created","Promise","all"],"sources":["src/views/CustomerDashboard.vue"],"sourcesContent":["<template>\r\n  <div class=\"customer-dashboard\">\r\n    <div class=\"container py-4\">\r\n      <!-- Welcome Section -->\r\n      <div class=\"row mb-4\">\r\n        <div class=\"col-md-8\">\r\n          <h2>Welcome, {{ userName }}!</h2>\r\n          <p class=\"text-muted\">Find services and manage your requests</p>\r\n        </div>\r\n        <div class=\"col-md-4 text-md-end\">\r\n          <button class=\"btn btn-primary\" @click=\"showNewRequestModal = true\">\r\n            <i class=\"fas fa-plus me-2\"></i>New Service Request\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Main Navigation Tabs -->\r\n      <ul class=\"nav nav-pills mb-4\">\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" :class=\"{ active: activeSection === 'browse' }\" \r\n             @click.prevent=\"activeSection = 'browse'\" href=\"#\">\r\n            <i class=\"fas fa-search me-1\"></i> Browse Services\r\n          </a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" :class=\"{ active: activeSection === 'requests' }\" \r\n             @click.prevent=\"activeSection = 'requests'\" href=\"#\">\r\n            <i class=\"fas fa-list-alt me-1\"></i> My Requests\r\n          </a>\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- Browse Services Section -->\r\n      <div v-if=\"activeSection === 'browse'\">\r\n        <!-- Search Services -->\r\n        <div class=\"card shadow-sm mb-4\">\r\n          <div class=\"card-body\">\r\n            <h5 class=\"card-title mb-3\">Search Services</h5>\r\n            <div class=\"row g-3\">\r\n              <div class=\"col-md-4\">\r\n                <div class=\"input-group\">\r\n                  <span class=\"input-group-text\">\r\n                    <i class=\"fas fa-search\"></i>\r\n                  </span>\r\n                  <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    v-model=\"searchQuery.name\"\r\n                    placeholder=\"Service name...\"\r\n                    @input=\"searchServices\"\r\n                  >\r\n                </div>\r\n              </div>\r\n              <div class=\"col-md-4\">\r\n                <div class=\"input-group\">\r\n                  <span class=\"input-group-text\">\r\n                    <i class=\"fas fa-map-marker-alt\"></i>\r\n                  </span>\r\n                  <input\r\n                    type=\"text\"\r\n                    class=\"form-control\"\r\n                    v-model=\"searchQuery.pinCode\"\r\n                    placeholder=\"PIN code...\"\r\n                    @input=\"searchServices\"\r\n                  >\r\n                </div>\r\n              </div>\r\n              <div class=\"col-md-4\">\r\n                <select class=\"form-select\" v-model=\"searchQuery.category\" @change=\"searchServices\">\r\n                  <option value=\"\">All Categories</option>\r\n                  <option v-for=\"category in categories\" :key=\"category\" :value=\"category\">\r\n                    {{ category }}\r\n                  </option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Services List -->\r\n        <div v-if=\"loading\" class=\"text-center py-5\">\r\n          <div class=\"spinner-border text-primary\" role=\"status\">\r\n            <span class=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n          <p class=\"mt-2\">Loading available services...</p>\r\n        </div>\r\n        \r\n        <div v-else-if=\"filteredServices.length === 0\" class=\"text-center py-5\">\r\n          <i class=\"fas fa-search fa-3x text-muted mb-3\"></i>\r\n          <h5>No services found</h5>\r\n          <p class=\"text-muted\">Try adjusting your search criteria</p>\r\n        </div>\r\n        \r\n        <div v-else class=\"row g-4\">\r\n          <div v-for=\"service in filteredServices\" :key=\"service.id\" class=\"col-md-4\">\r\n            <div class=\"card h-100 service-card\">\r\n              <div class=\"card-body\">\r\n                <h5 class=\"card-title\">{{ service.name }}</h5>\r\n                <p class=\"card-text text-truncate\">{{ service.description }}</p>\r\n                <div class=\"d-flex justify-content-between align-items-center mb-3\">\r\n                  <span class=\"badge bg-primary\">₹{{ service.base_price }}</span>\r\n                  <span class=\"text-muted\"><i class=\"far fa-clock me-1\"></i>{{ service.time_required }} min</span>\r\n                </div>\r\n                <div class=\"d-grid\">\r\n                  <button class=\"btn btn-outline-primary\" @click=\"selectService(service)\">\r\n                    <i class=\"fas fa-info-circle me-1\"></i> View Details\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- My Requests Section -->\r\n      <div v-if=\"activeSection === 'requests'\">\r\n        <!-- Service Requests Tabs -->\r\n        <ul class=\"nav nav-tabs mb-4\">\r\n          <li class=\"nav-item\">\r\n            <a \r\n              class=\"nav-link\" \r\n              :class=\"{ active: activeTab === 'active' }\"\r\n              @click.prevent=\"activeTab = 'active'\"\r\n              href=\"#\"\r\n            >\r\n              Active Requests\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <a \r\n              class=\"nav-link\" \r\n              :class=\"{ active: activeTab === 'completed' }\"\r\n              @click.prevent=\"activeTab = 'completed'\"\r\n              href=\"#\"\r\n            >\r\n              Completed\r\n            </a>\r\n          </li>\r\n        </ul>\r\n\r\n        <!-- Service Requests List -->\r\n        <div v-if=\"loading\" class=\"text-center py-5\">\r\n          <div class=\"spinner-border text-primary\" role=\"status\">\r\n            <span class=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n          <p class=\"mt-2\">Loading your requests...</p>\r\n        </div>\r\n        \r\n        <div v-else-if=\"filteredRequests.length === 0\" class=\"text-center py-5\">\r\n          <i class=\"fas fa-inbox fa-3x text-muted mb-3\"></i>\r\n          <h5>No service requests found</h5>\r\n          <p class=\"text-muted\">{{ activeTab === 'active' ? 'Create a new request to get started!' : 'No completed requests yet.' }}</p>\r\n        </div>\r\n        \r\n        <div v-else class=\"row g-4\">\r\n          <div v-for=\"request in filteredRequests\" :key=\"request.id\" class=\"col-md-6\">\r\n            <div class=\"card h-100 shadow-sm\">\r\n              <div class=\"card-body\">\r\n                <div class=\"d-flex justify-content-between align-items-start mb-3\">\r\n                  <h5 class=\"card-title mb-0\">{{ request.service.name }}</h5>\r\n                  <span :class=\"getStatusBadgeClass(request.status)\">\r\n                    {{ request.status }}\r\n                  </span>\r\n                </div>\r\n                \r\n                <div class=\"mb-3\">\r\n                  <small class=\"text-muted\">\r\n                    <i class=\"fas fa-calendar me-2\"></i>\r\n                    Requested: {{ formatDate(request.created_at) }}\r\n                  </small>\r\n                  <br v-if=\"request.completed_at\">\r\n                  <small v-if=\"request.completed_at\" class=\"text-muted\">\r\n                    <i class=\"fas fa-check-circle me-2\"></i>\r\n                    Completed: {{ formatDate(request.completed_at) }}\r\n                  </small>\r\n                </div>\r\n\r\n                <div v-if=\"request.professional\" class=\"mb-3\">\r\n                  <strong>Professional:</strong>\r\n                  <span>{{ request.professional.professional_name }}</span>\r\n                </div>\r\n\r\n                <p class=\"card-text\">{{ request.special_instructions || 'No special instructions' }}</p>\r\n\r\n                <!-- Action Buttons -->\r\n                <div class=\"d-flex justify-content-end gap-2\">\r\n                  <button\r\n                    v-if=\"request.status === 'pending' || request.status === 'assigned'\"\r\n                    class=\"btn btn-outline-danger btn-sm\"\r\n                    @click=\"closeRequest(request)\"\r\n                  >\r\n                    <i class=\"fas fa-times me-1\"></i>\r\n                    Cancel\r\n                  </button>\r\n                  <button\r\n                    v-if=\"request.status === 'pending'\"\r\n                    class=\"btn btn-outline-primary btn-sm\"\r\n                    @click=\"editRequest(request)\"\r\n                  >\r\n                    <i class=\"fas fa-edit me-1\"></i>\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    v-if=\"request.status === 'completed' && !request.has_review\"\r\n                    class=\"btn btn-outline-success btn-sm\"\r\n                    @click=\"addReview(request)\"\r\n                  >\r\n                    <i class=\"fas fa-star me-1\"></i>\r\n                    Review\r\n                  </button>\r\n                  <button\r\n                    class=\"btn btn-outline-secondary btn-sm\"\r\n                    @click=\"viewRequestDetails(request)\"\r\n                  >\r\n                    <i class=\"fas fa-eye me-1\"></i>\r\n                    Details\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Service Details Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showServiceModal }\" v-if=\"showServiceModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">Service Details</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showServiceModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\" v-if=\"selectedService\">\r\n            <div class=\"service-details\">\r\n              <h4>{{ selectedService.name }}</h4>\r\n              <div class=\"d-flex justify-content-between mb-3\">\r\n                <span class=\"badge bg-primary fs-5\">₹{{ selectedService.base_price }}</span>\r\n                <span class=\"text-muted\"><i class=\"far fa-clock me-2\"></i>{{ selectedService.time_required }} minutes</span>\r\n              </div>\r\n              <p>{{ selectedService.description }}</p>\r\n              <div class=\"mb-3\">\r\n                <strong>Category:</strong> {{ selectedService.category }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" @click=\"showServiceModal = false\">Close</button>\r\n            <button type=\"button\" class=\"btn btn-primary\" @click=\"requestSelectedService\">\r\n              <i class=\"fas fa-plus me-1\"></i> Request Service\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- New Service Request Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showNewRequestModal }\" v-if=\"showNewRequestModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">New Service Request</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showNewRequestModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <form @submit.prevent=\"createRequest\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"serviceType\" class=\"form-label\">Service Type</label>\r\n                <select id=\"serviceType\" name=\"serviceType\" class=\"form-select\" v-model=\"newRequest.service_id\" required>\r\n                  <option value=\"\">Select a service</option>\r\n                  <option v-for=\"service in services\" :key=\"service.id\" :value=\"service.id\">\r\n                    {{ service.name }} - ₹{{ service.base_price }}\r\n                  </option>\r\n                </select>\r\n              </div>\r\n\r\n              <div class=\"mb-3\">\r\n                <label for=\"pinCode\" class=\"form-label\">PIN Code</label>\r\n                <input\r\n                  id=\"pinCode\"\r\n                  name=\"pinCode\"\r\n                  type=\"text\"\r\n                  class=\"form-control\"\r\n                  v-model=\"newRequest.pin_code\"\r\n                  required\r\n                  pattern=\"[0-9]{6}\"\r\n                  placeholder=\"Enter 6-digit PIN code\"\r\n                >\r\n              </div>\r\n\r\n              <div class=\"mb-3\">\r\n                <label for=\"specialInstructions\" class=\"form-label\">Special Instructions</label>\r\n                <textarea\r\n                  id=\"specialInstructions\"\r\n                  name=\"specialInstructions\"\r\n                  class=\"form-control\"\r\n                  v-model=\"newRequest.special_instructions\"\r\n                  rows=\"3\"\r\n                  placeholder=\"Any specific requirements or details...\"\r\n                ></textarea>\r\n              </div>\r\n              \r\n              <div class=\"text-end\">\r\n                <button type=\"button\" class=\"btn btn-secondary me-2\" @click=\"showNewRequestModal = false\">\r\n                  Cancel\r\n                </button>\r\n                <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"isLoading\">\r\n                  <span v-if=\"isLoading\" class=\"spinner-border spinner-border-sm me-2\"></span>\r\n                  Create Request\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Review Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showReviewModal }\" v-if=\"showReviewModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">Add Review</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showReviewModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <form @submit.prevent=\"submitReview\">\r\n              <div class=\"mb-3\">\r\n                <label for=\"rating\" class=\"form-label\">Rating</label>\r\n                <div class=\"star-rating\" id=\"rating\">\r\n                  <i\r\n                    v-for=\"star in 5\"\r\n                    :key=\"star\"\r\n                    class=\"fas fa-star\"\r\n                    :class=\"{ active: star <= review.rating }\"\r\n                    @click=\"review.rating = star\"\r\n                  ></i>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"mb-3\">\r\n                <label for=\"reviewRemarks\" class=\"form-label\">Comments</label>\r\n                <textarea\r\n                  id=\"reviewRemarks\"\r\n                  name=\"reviewRemarks\"\r\n                  class=\"form-control\"\r\n                  v-model=\"review.remarks\"\r\n                  rows=\"3\"\r\n                  required\r\n                  placeholder=\"Share your experience...\"\r\n                ></textarea>\r\n              </div>\r\n              \r\n              <div class=\"text-end\">\r\n                <button type=\"button\" class=\"btn btn-secondary me-2\" @click=\"showReviewModal = false\">\r\n                  Cancel\r\n                </button>\r\n                <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"isLoading\">\r\n                  <span v-if=\"isLoading\" class=\"spinner-border spinner-border-sm me-2\"></span>\r\n                  Submit Review\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Request Details Modal -->\r\n    <div class=\"modal fade\" :class=\"{ show: showRequestDetailsModal }\" v-if=\"showRequestDetailsModal\">\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">Request Details</h5>\r\n            <button type=\"button\" class=\"btn-close\" @click=\"showRequestDetailsModal = false\"></button>\r\n          </div>\r\n          <div class=\"modal-body\" v-if=\"selectedRequest\">\r\n            <div class=\"request-details\">\r\n              <h4>{{ selectedRequest.service?.name }}</h4>\r\n              \r\n              <div class=\"mb-3\">\r\n                <span :class=\"getStatusBadgeClass(selectedRequest.status)\">\r\n                  {{ selectedRequest.status }}\r\n                </span>\r\n              </div>\r\n              \r\n              <div class=\"mb-3\">\r\n                <h6>Request Timeline</h6>\r\n                <div class=\"timeline\">\r\n                  <div class=\"timeline-item\">\r\n                    <div class=\"timeline-marker bg-primary\"></div>\r\n                    <div class=\"timeline-content\">\r\n                      <div class=\"timeline-heading\">\r\n                        <h6 class=\"mb-0\">Request Created</h6>\r\n                        <small>{{ formatDate(selectedRequest.created_at) }}</small>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div v-if=\"selectedRequest.accepted_at\" class=\"timeline-item\">\r\n                    <div class=\"timeline-marker bg-info\"></div>\r\n                    <div class=\"timeline-content\">\r\n                      <div class=\"timeline-heading\">\r\n                        <h6 class=\"mb-0\">Request Accepted</h6>\r\n                        <small>{{ formatDate(selectedRequest.accepted_at) }}</small>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div v-if=\"selectedRequest.completed_at\" class=\"timeline-item\">\r\n                    <div class=\"timeline-marker bg-success\"></div>\r\n                    <div class=\"timeline-content\">\r\n                      <div class=\"timeline-heading\">\r\n                        <h6 class=\"mb-0\">Service Completed</h6>\r\n                        <small>{{ formatDate(selectedRequest.completed_at) }}</small>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  <div v-if=\"selectedRequest.closed_at\" class=\"timeline-item\">\r\n                    <div class=\"timeline-marker bg-secondary\"></div>\r\n                    <div class=\"timeline-content\">\r\n                      <div class=\"timeline-heading\">\r\n                        <h6 class=\"mb-0\">Request Closed</h6>\r\n                        <small>{{ formatDate(selectedRequest.closed_at) }}</small>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div class=\"mb-3\" v-if=\"selectedRequest.professional\">\r\n                <h6>Professional Details</h6>\r\n                <p class=\"mb-1\"><strong>Name:</strong> {{ selectedRequest.professional.professional_name }}</p>\r\n                <p class=\"mb-0\"><strong>Contact:</strong> {{ selectedRequest.professional.phone || 'N/A' }}</p>\r\n              </div>\r\n              \r\n              <div class=\"mb-3\">\r\n                <h6>Special Instructions</h6>\r\n                <p class=\"mb-0\">{{ selectedRequest.special_instructions || 'No special instructions provided.' }}</p>\r\n              </div>\r\n              \r\n              <div class=\"mb-0\" v-if=\"selectedRequest.review\">\r\n                <h6>Your Review</h6>\r\n                <div class=\"stars mb-2\">\r\n                  <i v-for=\"n in 5\" :key=\"n\"\r\n                     class=\"fas fa-star\"\r\n                     :class=\"n <= selectedRequest.review.rating ? 'text-warning' : 'text-muted'\"></i>\r\n                </div>\r\n                <p class=\"mb-0\">{{ selectedRequest.review.remarks }}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" @click=\"showRequestDetailsModal = false\">Close</button>\r\n            \r\n            <button \r\n              v-if=\"selectedRequest && selectedRequest.status === 'completed' && !selectedRequest.review\"\r\n              type=\"button\" \r\n              class=\"btn btn-primary\" \r\n              @click=\"addReview(selectedRequest)\">\r\n              <i class=\"fas fa-star me-1\"></i> Add Review\r\n            </button>\r\n            \r\n            <button \r\n              v-if=\"selectedRequest && (selectedRequest.status === 'pending' || selectedRequest.status === 'assigned')\"\r\n              type=\"button\" \r\n              class=\"btn btn-danger\" \r\n              @click=\"closeRequest(selectedRequest, true)\">\r\n              <i class=\"fas fa-times me-1\"></i> Cancel Request\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { customerAPI, serviceAPI } from '@/services/api'\r\n\r\nexport default {\r\n  name: 'CustomerDashboard',\r\n  data() {\r\n    return {\r\n      userName: JSON.parse(localStorage.getItem('user'))?.name || 'Customer',\r\n      activeSection: 'browse', // 'browse' or 'requests'\r\n      activeTab: 'active', // For requests: 'active' or 'completed'\r\n      searchQuery: {\r\n        name: '',\r\n        pinCode: '',\r\n        category: ''\r\n      },\r\n      services: [],\r\n      categories: [],\r\n      serviceRequests: [],\r\n      showNewRequestModal: false,\r\n      showReviewModal: false,\r\n      showServiceModal: false,\r\n      showRequestDetailsModal: false,\r\n      isLoading: false,\r\n      loading: false, // General loading state\r\n      newRequest: {\r\n        service_id: '',\r\n        pin_code: '',\r\n        special_instructions: ''\r\n      },\r\n      review: {\r\n        rating: 0,\r\n        remarks: ''\r\n      },\r\n      selectedRequest: null,\r\n      selectedService: null,\r\n      error: null\r\n    }\r\n  },\r\n  computed: {\r\n    filteredRequests() {\r\n      return this.serviceRequests.filter(request => {\r\n        if (this.activeTab === 'active') {\r\n          return ['pending', 'assigned', 'in_progress'].includes(request.status)\r\n        } else {\r\n          return ['completed', 'closed'].includes(request.status)\r\n        }\r\n      })\r\n    },\r\n    filteredServices() {\r\n      if (!this.services.length) return [];\r\n      \r\n      return this.services.filter(service => {\r\n        // Filter by name\r\n        if (this.searchQuery.name && !service.name.toLowerCase().includes(this.searchQuery.name.toLowerCase())) {\r\n          return false;\r\n        }\r\n        \r\n        // Filter by category\r\n        if (this.searchQuery.category && service.category !== this.searchQuery.category) {\r\n          return false;\r\n        }\r\n        \r\n        // Filter by PIN code if implemented\r\n        if (this.searchQuery.pinCode && service.available_pin_codes) {\r\n          if (!service.available_pin_codes.includes(this.searchQuery.pinCode)) {\r\n            return false;\r\n          }\r\n        }\r\n        \r\n        return true;\r\n      });\r\n    }\r\n  },\r\n  methods: {\r\n    async fetchServices() {\r\n      try {\r\n        this.loading = true;\r\n        console.log('CustomerDashboard: Fetching services...');\r\n        const response = await serviceAPI.getServices();\r\n        console.log(`CustomerDashboard: Received ${response.length} services`);\r\n        this.services = response;\r\n        this.loading = false;\r\n      } catch (error) {\r\n        console.error('CustomerDashboard: Error fetching services:', error);\r\n        this.error = 'Failed to load services. Please try again.';\r\n        this.loading = false;\r\n        \r\n        // Retry after a delay in case of network issues\r\n        setTimeout(() => {\r\n          if (this.services.length === 0) {\r\n            console.log('Retrying service fetch...');\r\n            this.fetchServices();\r\n          }\r\n        }, 3000);\r\n      }\r\n    },\r\n    async fetchServiceTypes() {\r\n      try {\r\n        console.log('CustomerDashboard: Fetching service types...');\r\n        const response = await serviceAPI.getServiceTypes();\r\n        console.log(`CustomerDashboard: Received ${response.length} service types`);\r\n        this.categories = response;\r\n      } catch (error) {\r\n        console.error('CustomerDashboard: Error fetching service types:', error);\r\n        this.error = 'Failed to load service categories. Please try again.';\r\n      }\r\n    },\r\n    async fetchRequests() {\r\n      try {\r\n        this.loading = true;\r\n        const response = await customerAPI.getRequests();\r\n        this.serviceRequests = response;\r\n        this.loading = false;\r\n      } catch (error) {\r\n        console.error('Error fetching requests:', error);\r\n        this.error = 'Failed to load service requests. Please try again.';\r\n        this.loading = false;\r\n      }\r\n    },\r\n    async searchServices() {\r\n      // You can implement additional search logic here if needed\r\n      // For now, we'll just use the computed filteredServices property\r\n    },\r\n    async createRequest() {\r\n      this.isLoading = true;\r\n      try {\r\n        await customerAPI.createRequest(this.newRequest);\r\n        this.showNewRequestModal = false;\r\n        this.newRequest = { service_id: '', pin_code: '', special_instructions: '' };\r\n        this.activeSection = 'requests'; // Switch to requests tab\r\n        await this.fetchRequests();\r\n        alert('Service request created successfully!');\r\n      } catch (error) {\r\n        console.error('Error creating request:', error);\r\n        alert('Failed to create service request: ' + (error.message || 'Unknown error'));\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n    async closeRequest(request, fromModal = false) {\r\n      if (confirm('Are you sure you want to cancel this request?')) {\r\n        try {\r\n          this.isLoading = true;\r\n          await customerAPI.closeRequest(request.id);\r\n          await this.fetchRequests();\r\n          if (fromModal) {\r\n            this.showRequestDetailsModal = false;\r\n          }\r\n          alert('Request cancelled successfully.');\r\n        } catch (error) {\r\n          console.error('Error closing request:', error);\r\n          alert('Failed to cancel request: ' + (error.message || 'Unknown error'));\r\n        } finally {\r\n          this.isLoading = false;\r\n        }\r\n      }\r\n    },\r\n    editRequest(request) {\r\n      // Implement edit functionality (e.g., populate form with current values)\r\n      this.newRequest = {\r\n        service_id: request.service_id,\r\n        pin_code: request.pin_code,\r\n        special_instructions: request.special_instructions || ''\r\n      };\r\n      this.showNewRequestModal = true;\r\n    },\r\n    addReview(request) {\r\n      this.selectedRequest = request;\r\n      this.review = { rating: 0, remarks: '' };\r\n      this.showReviewModal = true;\r\n      if (this.showRequestDetailsModal) {\r\n        this.showRequestDetailsModal = false;\r\n      }\r\n    },\r\n    async submitReview() {\r\n      try {\r\n        this.isLoading = true;\r\n        await customerAPI.addReview(this.selectedRequest.id, this.review);\r\n        this.showReviewModal = false;\r\n        this.review = { rating: 0, remarks: '' };\r\n        await this.fetchRequests();\r\n        alert('Review submitted successfully.');\r\n      } catch (error) {\r\n        console.error('Error submitting review:', error);\r\n        alert('Failed to submit review: ' + (error.message || 'Unknown error'));\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n    \r\n    selectService(service) {\r\n      this.selectedService = service;\r\n      this.showServiceModal = true;\r\n    },\r\n    \r\n    requestSelectedService() {\r\n      this.newRequest.service_id = this.selectedService.id;\r\n      this.showServiceModal = false;\r\n      this.showNewRequestModal = true;\r\n    },\r\n    \r\n    viewRequestDetails(request) {\r\n      this.selectedRequest = request;\r\n      this.showRequestDetailsModal = true;\r\n    },\r\n    \r\n    formatDate(dateString) {\r\n      if (!dateString) return 'N/A';\r\n      const date = new Date(dateString);\r\n      return date.toLocaleString('en-US', {\r\n        year: 'numeric',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    },\r\n    \r\n    getStatusBadgeClass(status) {\r\n      const classes = {\r\n        pending: 'badge bg-warning',\r\n        assigned: 'badge bg-info',\r\n        in_progress: 'badge bg-primary',\r\n        completed: 'badge bg-success',\r\n        closed: 'badge bg-secondary',\r\n        cancelled: 'badge bg-danger'\r\n      };\r\n      return classes[status] || 'badge bg-secondary';\r\n    }\r\n  },\r\n  async created() {\r\n    await Promise.all([\r\n      this.fetchServices(),\r\n      this.fetchServiceTypes(),\r\n      this.fetchRequests()\r\n    ]);\r\n  }\r\n}\r\n</script>\r\n\r\n<!-- Add styling as needed -->\r\n<style scoped>\r\n.customer-dashboard {\r\n  background-color: #f8f9fa;\r\n  min-height: 100vh;\r\n}\r\n\r\n.service-card {\r\n  transition: transform 0.2s, box-shadow 0.2s;\r\n}\r\n\r\n.service-card:hover {\r\n  transform: translateY(-5px);\r\n  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.nav-pills .nav-link,\r\n.nav-tabs .nav-link {\r\n  cursor: pointer;\r\n}\r\n\r\n.modal.show {\r\n  display: block;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n.star-rating {\r\n  display: flex;\r\n  gap: 5px;\r\n}\r\n\r\n.star-rating i {\r\n  cursor: pointer;\r\n  color: #e0e0e0;\r\n}\r\n\r\n.star-rating i.active {\r\n  color: #ffc107;\r\n}\r\n\r\n.timeline {\r\n  position: relative;\r\n  padding-left: 30px;\r\n}\r\n\r\n.timeline-item {\r\n  position: relative;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.timeline-marker {\r\n  position: absolute;\r\n  left: -30px;\r\n  top: 5px;\r\n  width: 15px;\r\n  height: 15px;\r\n  border-radius: 50%;\r\n}\r\n\r\n.timeline:before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: -23px;\r\n  width: 2px;\r\n  background-color: #e9ecef;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
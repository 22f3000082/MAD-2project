{"ast":null,"code":"import axios from 'axios';\nimport router from '@/router';\n\n// Create axios instance with custom config\nconst api = axios.create({\n  baseURL: 'http://localhost:8080',\n  headers: {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json'\n  },\n  withCredentials: true // Important for CORS with credentials\n});\n\n// Request interceptor\napi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers['Authorization'] = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  console.error('Request error:', error);\n  return Promise.reject(error);\n});\n\n// Response interceptor\napi.interceptors.response.use(response => response, error => {\n  console.error('Response error:', error.response?.data || error.message);\n  if (error.response) {\n    switch (error.response.status) {\n      case 401:\n        // Unauthorized - clear storage and redirect to login\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        router.push('/login');\n        break;\n      case 403:\n        // Forbidden - redirect to home\n        router.push('/');\n        break;\n      case 500:\n        console.error('Server error:', error.response.data);\n        break;\n    }\n    // Return the error message from the backend if available\n    if (error.response.data && error.response.data.message) {\n      return Promise.reject(new Error(error.response.data.message));\n    }\n  }\n  return Promise.reject(error);\n});\n\n// API Services\n// API Services\nexport const authService = {\n  async register(userData) {\n    try {\n      // Ensure professionals have a selected service type\n      if (userData.role === 'professional' && !userData.service_type) {\n        throw new Error(\"Professionals must select a service type.\");\n      }\n      console.log('Sending registration data:', userData);\n      const response = await api.post('/auth/register', userData);\n      console.log('Registration response:', response.data);\n      return response.data;\n    } catch (error) {\n      console.error('Registration error:', error.response?.data || error.message);\n\n      // Capture and return specific backend errors\n      throw error.response?.data || {\n        message: \"Registration failed. Please try again.\"\n      };\n    }\n  },\n  async login(credentials) {\n    try {\n      console.log('Attempting login:', credentials);\n      const response = await api.post('/auth/login', credentials);\n      console.log('Login response:', response.data);\n      if (response.data.token) {\n        localStorage.setItem('token', response.data.token);\n        localStorage.setItem('user', JSON.stringify(response.data.user));\n        // Redirect based on user role\n        const user = response.data.user;\n        router.push(`/${user.role}/dashboard`);\n      }\n      return response.data;\n    } catch (error) {\n      console.error('Login error:', error.response?.data || error.message);\n      throw error;\n    }\n  },\n  async logout() {\n    try {\n      await api.post('/auth/logout');\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      router.push('/login');\n    } catch (error) {\n      console.error('Logout error:', error.response?.data || error.message);\n      // Still clear local storage and redirect even if API call fails\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      router.push('/login');\n    }\n  },\n  getCurrentUser() {\n    const userStr = localStorage.getItem('user');\n    return userStr ? JSON.parse(userStr) : null;\n  }\n};\nexport const serviceAPI = {\n  async getServices(params = {}) {\n    try {\n      const response = await api.get('/api/services', {\n        params\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching services:', error);\n      throw error;\n    }\n  },\n  async mounted() {\n    try {\n      this.services = await this.searchServices();\n      console.log(\"Services loaded:\", this.services);\n    } catch (error) {\n      console.error(\"Failed to load services:\", error);\n    }\n  },\n  async getServiceById(id) {\n    try {\n      const response = await api.get(`/api/services/${id}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching service:', error);\n      throw error;\n    }\n  }\n};\n// async searchServices(params) {\n//   try {\n//     const response = await api.get('/api/services/search', { params })\n//     return response.data\n//   } catch (error) {\n//     console.error('Error searching services:', error)\n//     throw error\n//   }\n// },\n\nexport const customerAPI = {\n  async getRequests() {\n    try {\n      const response = await api.get('/api/customer/requests');\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching requests:', error);\n      throw error;\n    }\n  },\n  async createRequest(data) {\n    try {\n      const response = await api.post('/api/customer/requests', data);\n      return response.data;\n    } catch (error) {\n      console.error('Error creating request:', error);\n      throw error;\n    }\n  },\n  async updateRequest(requestId, data) {\n    try {\n      const response = await api.put(`/api/customer/requests/${requestId}`, data);\n      return response.data;\n    } catch (error) {\n      console.error('Error updating request:', error);\n      throw error;\n    }\n  },\n  async closeRequest(requestId) {\n    try {\n      const response = await api.put(`/api/customer/requests/${requestId}/close`);\n      return response.data;\n    } catch (error) {\n      console.error('Error closing request:', error);\n      throw error;\n    }\n  },\n  async addReview(requestId, reviewData) {\n    try {\n      const response = await api.post(`/api/customer/requests/${requestId}/review`, reviewData);\n      return response.data;\n    } catch (error) {\n      console.error('Error adding review:', error);\n      throw error;\n    }\n  }\n};\nexport const professionalAPI = {\n  async getAssignments(status = null) {\n    try {\n      const params = status ? {\n        status\n      } : {};\n      const response = await api.get('/api/professional/assignments', {\n        params\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching assignments:', error);\n      throw error;\n    }\n  },\n  async updateStatus(requestId, status) {\n    try {\n      const response = await api.put(`/api/professional/requests/${requestId}`, {\n        status\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error updating status:', error);\n      throw error;\n    }\n  },\n  async getProfile() {\n    try {\n      const response = await api.get('/api/professional/profile');\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching profile:', error);\n      throw error;\n    }\n  },\n  async updateProfile(data) {\n    try {\n      const response = await api.put('/api/professional/profile', data);\n      return response.data;\n    } catch (error) {\n      console.error('Error updating profile:', error);\n      throw error;\n    }\n  }\n};\nexport const adminAPI = {\n  async getUsers(role = null) {\n    try {\n      const params = role ? {\n        role\n      } : {};\n      const response = await api.get('/api/admin/users', {\n        params\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching users:', error);\n      throw error;\n    }\n  },\n  async approveUser(userId) {\n    try {\n      const response = await api.post(`/api/admin/users/${userId}/approve`);\n      return response.data;\n    } catch (error) {\n      console.error('Error approving user:', error);\n      throw error;\n    }\n  },\n  async blockUser(userId) {\n    try {\n      const response = await api.post(`/api/admin/users/${userId}/block`);\n      return response.data;\n    } catch (error) {\n      console.error('Error blocking user:', error);\n      throw error;\n    }\n  },\n  async getServices() {\n    try {\n      const response = await api.get('/api/admin/services');\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching services:', error);\n      throw error;\n    }\n  },\n  async createService(serviceData) {\n    try {\n      const response = await api.post('/api/admin/services', serviceData);\n      return response.data;\n    } catch (error) {\n      console.error('Error creating service:', error);\n      throw error;\n    }\n  },\n  async updateService(serviceId, serviceData) {\n    try {\n      const response = await api.put(`/api/admin/services/${serviceId}`, serviceData);\n      return response.data;\n    } catch (error) {\n      console.error('Error updating service:', error);\n      throw error;\n    }\n  },\n  async deleteService(serviceId) {\n    try {\n      const response = await api.delete(`/api/admin/services/${serviceId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error deleting service:', error);\n      throw error;\n    }\n  }\n};\nexport default api;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}